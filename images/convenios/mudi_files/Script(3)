function AllocationViewModel(a,b,c,f,e){var d=this;d.Container=a;d.MaxTasksVisible=ko.observable(b);d.NewTaskTitle=(f||Resources.Task.NewTask);d.NewTaskOrderText=(e||Resources.Commons.New);d.OriginalTasks=ko.observableArray([]);d.DaysOff=ko.observableArray([]);d.Dates=ko.observableArray([]);d.Entries=ko.observableArray([]);d.UserID=ko.observable(0);d.SelectedDate=ko.observable(undefined);d.DatepickerSelectedDate=ko.observable(null);d.datepickerInput=null;d.datepicker=null;d.SetupDatePicker=function(){var g=$("<div>").addClass("datepicker-container");d.datepickerInput=$('<input style="float: left;">').attr("type","text");d.datepickerInput.appendTo(g);$(g).insertBefore(d.Container);d.datepicker=d.datepickerInput.datepicker({format:"dd/mm/yyyy",autoclose:true}).on("changeDate",function(h){d.SelectedInterval(AllocationIntervalDays.SelectDate);d.DatepickerSelectedDate($M(d.datepicker.getDate(),true).toJsonDate());d.reloadAllocationData();}).data("datepicker");setTimeout(function(){d.datepickerInput.datepicker("setStartDate",$M(null,true).format("DD/MM/YYYY"));
d.datepickerInput.datepicker("hide");},500);};d.DefaultInterval=AllocationIntervalDays.TenDays;d.SelectedInterval=ko.observable(d.DefaultInterval);d.SelectedIntervalText=ko.computed(function(){var g="";if(d.SelectedInterval()==AllocationIntervalDays.TwentyDays){g=Resources.Task.TwentyDays;}else{if(d.SelectedInterval()==AllocationIntervalDays.NextFreeDay){g=Resources.Task.NextFreeDay;}else{if(d.SelectedInterval()==AllocationIntervalDays.SelectDate){if(d.DatepickerSelectedDate()!=null){g=$M(d.DatepickerSelectedDate(),true).format("DD/MM");}else{g=Resources.Task.SelectDate;}}else{g=Resources.Task.TenDays;}}}return g;});d.Clear=function(){$(d.Container).hide();d.UserID(0);d.SelectedDate(null);d.DatepickerSelectedDate(null);d.SelectedInterval(d.DefaultInterval);d.datepickerInput.datepicker("setValue",new Date());d.datepickerInput.datepicker("hide");d.Entries([]);};d.OpenDatePicker=function(){var g=(d.SelectedDate()!=null)?$M(d.SelectedDate(),true):$M(null,true);d.datepickerInput.datepicker("update",g.format("DD/MM/YYYY"));
d.datepickerInput.datepicker("show");};d.SetInterval=function(h,g){d.SelectedInterval(h);d.DatepickerSelectedDate(null);if(h!=AllocationIntervalDays.SelectDate){d.datepickerInput.datepicker("hide");d.SelectedDate(null);if(d.UserID()&&d.UserID()>0){d.reloadAllocationData(g);}}};d.SelectNewTaskDueDate=function(g){var h=$M(g.DateCalendar,true);$(".dueDateDay",$(d.Container)).removeClass("selected");$("li[data-day="+h.date()+"][data-month="+(h.month()+1)+"][data-year="+h.year()+"] .dueDateDay",$(d.Container)).addClass("selected");d.SelectedDate(g.DateCalendar);d.AddTaskPreview(h);};d.SelectedDate.subscribe(function(g){if(c&&typeof(c)=="function"){c(g);}});d.AddTaskPreview=function(g){d.CurrentEntries={Date:null,Entries:[]};var l=d.CreateNewTask(g);var n=_.clone(d.OriginalTasks());var k=-1;for(var j=0;j<n.length;j++){var m=n[j];if($M(m.DueDate,true).diffDays(g)>0){k=j;break;}}if(k==-1){n.push(l);}else{n.splice(k,0,l);}var h=d.LoadEntries(n);d.Entries(h);d.ScrollToNewTask();};d.CreateNewTask=function(g){var h={DueDate:g.toJsonDate(),AbsoluteUserOrder:d.NewTaskOrderText,EffortEstimation:null,TaskTitle:d.NewTaskTitle,TaskID:0,TaskNumber:"",Undisclosed:false,CreationUser:{UserID:environmentData.currentUserID,UserHashCode:"",UserLogin:""},JobTitle:"",JobType:"",JobNumber:"",ClientNickName:"",ClientDisplayName:""};
return h;};d.SelectOwner=function(i,h,g){d.UserID(i);if(h){d.SelectedDate(h);d.DatepickerSelectedDate(h);d.datepickerInput.datepicker("setValue",$M(h,true).toDate());d.SelectedInterval(AllocationIntervalDays.SelectDate);d.reloadAllocationData(g);}else{d.SelectedDate(null);d.DatepickerSelectedDate(null);d.datepickerInput.datepicker("setValue",new Date());if(d.DefaultInterval==d.SelectedInterval()){d.reloadAllocationData(g);}else{d.SetInterval(d.DefaultInterval,g);}}};d.scrollToTop=function(){$(d.Container).scrollTop(0);$(d.Container).jsScroll();};d.scrollToElement=function(g){var h=$(d.Container).offset().top;var i=$(g).offset().top;var j=(i-h)+$(d.Container).scrollTop();$(d.Container).scrollTop(j);$(d.Container).jsScroll();};d.reloadAllocationData=function(g){var j=function(l,m,n){$(d.Container).hide();taskrow.DisplayLoading();d.LoadAllocationData(l,m,n,function(){$(d.Container).show();d.ScrollToNewTask();$(d.Container).jsScroll();taskrow.HideLoading();$(window).trigger("taskrow:modalbodyresized");
if(g){g();}});};var h=10;var i=false;var k=null;if(d.SelectedInterval()==AllocationIntervalDays.TenDays){h=10;}else{if(d.SelectedInterval()==AllocationIntervalDays.TwentyDays){h=20;}else{if(d.SelectedInterval()==AllocationIntervalDays.NextFreeDay){i=true;}else{if(d.SelectedInterval()==AllocationIntervalDays.SelectDate){k=$M(d.DatepickerSelectedDate(),true);}}}}j.apply(d,[h,i,k]);};d.CurrentEntries={Date:null,Entries:[]};d.FilterEntriesByDate=function(h){var g=d.Entries();if(d.CurrentEntries.Date==null||d.CurrentEntries.Date!=h.DateCalendar){var i=$M(h.DateCalendar,true).startOfDay();d.CurrentEntries.Date=h.DateCalendar;d.CurrentEntries.Entries=ko.utils.arrayFilter(g,function(k){var m=k.Title;var l=$M(k.StartDate,true).startOfDay();var j=$M(k.EndDate,true).startOfDay();return(j.diffDays(i)<0&&h.DateCalendar==d.Dates()[0].DateCalendar)||(j.diffDays(i)>=0&&l.diffDays(i)<=0);});}return d.CurrentEntries.Entries;};d.MoreTaksAndHaveNewTask=function(h){var i=d.FilterEntriesByDate(h);if(i.length<=d.MaxTasksVisible()){return false;
}var g=ko.utils.arrayFirst(i,function(j){return j.TaskID==0;});return(g&&g!=null);};d.TasksCount=function(g){var h=d.FilterEntriesByDate(g).length;return h;};d.LoadAllocationData=function(j,k,l,g){if(!k){k=false;}var m=$M(null,true);var h=(l)?$M(l,true):$M(null,true);var i=h.diffDays(m);if(i>(j/2)){h.add(-(j/2),"days");}else{h.add(-(i),"days");}$.ajax({url:"Allocation/GetUserTasksPlan/",data:{userID:d.UserID(),interval:j,nextFreeDay:k,refDate:h.startOfDay().format("YYYY-MM-DDT00:00:00"),},success:function(n,r){if(n.Success){d.OriginalTasks(n.Entity.Tasks);d.DaysOff(n.Entity.DaysOff);d.Dates(n.Entity.Dates);if(l){var p=_.filter(n.Entity.Dates,function(s){return $M(s.DateCalendar).diffDays(l)==0;})[0];if(p&&!p.Absent){d.SelectNewTaskDueDate({DateCalendar:l.toJsonDate()});}else{d.DatepickerSelectedDate(null);d.SelectedDate(null);var o=_.clone(d.OriginalTasks());var q=d.LoadEntries(o);d.Entries(q);d.scrollToTop();}}else{if(n.Entity.NextFreeDay){d.SelectNewTaskDueDate({DateCalendar:n.Entity.NextFreeDay});
}else{var o=_.clone(d.OriginalTasks());var q=d.LoadEntries(o);d.Entries(q);d.scrollToTop();}}if(g&&typeof(g)=="function"){g();}}else{console.error(n.Message);}},error:function(){UI.Alert(Resources.Commons.UnexpectedError);taskrow.HideLoading();}});};d.ScrollToNewTask=function(){var i=$("div.taskitem.new-task:first");if(i&&i.length>0){var j=i.parent().parent();if(j.parent().hasClass("expanded")){var k=$("div.taskitem.new-task").parent();if(k.length>0){if(k.prev().length>0){d.scrollToElement(k.prev());}else{d.scrollToElement(k);}}}else{var g=$("div.DueDateselector .dueDateDay.selected");if(g.length>0){var h=g.parent().parent();if(h.prev().length>0){h=h.prev();}d.scrollToElement(h);}else{var h=j.parent().parent();d.scrollToElement(h);}}}else{d.scrollToTop();}};d.LoadEntries=function(h){var y=this;var l=[];var p=$M(y.Dates()[0].DateCalendar,true);var s=$M(y.Dates()[y.Dates().length-1].DateCalendar,true);var w=y.GetNextAvailableDate($M(y.Dates()[0].DateCalendar,true),s);var x=$M(w,true);var t=$M(w,true).add(-1,"days").startOfDay();
for(var q=0;q<h.length;q++){var z=h[q];var m={};var A=$M(z.DueDate,true);if(A.diffDays(p)<=0){m.StartDate=p.toJsonDate();m.EndDate=p.toJsonDate();m.Delayed=true;}else{if(w.diffDays(t)<=0){w=$M(t,true);}if(w.diffDays(t)==0&&w.diffDays(A)<0){w=$M(t,true).add(1,"days").startOfDay();}if($M(z.DueDate,true).diffDays(w)>0){if(x.diffDays(w)>0){w=$M(x,true);}var v=y.GetNextAvailableDate(w,A);if(v!=null){w=$M(v,true);}}m.StartDate=w.toJsonDate();m.EndDate=z.DueDate;if(A.diffDays(w)<0){m.StartDate=$M(t,true);if(m.StartDate.diffDays(A)<0){m.StartDate=$M(t,true).add(1,"days").startOfDay();}m.StartDate=m.StartDate.toJsonDate();}}m.CreationUser=z.CreationUser?{UserID:z.CreationUser.UserID,UserHashCode:z.CreationUser.UserHashCode,UserLogin:z.CreationUser.UserLogin}:{UserID:0,UserHashCode:0,UserLogin:""};m.JobType=z.JobType;m.JobTitle=z.JobTitle;m.JobNumber=z.JobNumber;m.ClientNickName=z.ClientNickName;m.ClientDisplayName=z.ClientDisplayName;m.TaskID=z.TaskID;m.TaskNumber=z.TaskNumber;m.Title=z.TaskTitle;
m.Undisclosed=z.Undisclosed;m.AbsoluteUserOrder=z.AbsoluteUserOrder;m.EffortEstimation=z.EffortEstimation;m.RealDueDate=z.DueDate;l.push(m);t=$M(m.EndDate,true);}for(var q=0;q<l.length;q++){var g=l[q];g.StartDate=$M(g.StartDate).toJsonDate();g.EndDate=$M(g.EndDate).toJsonDate();if(g.EndDate==g.StartDate){continue;}var o=$M(g.StartDate,true);var n=$M(g.EndDate,true);var u={};var k=$.extend(true,[],y.DaysOff());for(var r=0;r<k.length;r++){if($M(k[r].Start,true).diffDays(n)<=0&&$M(k[r].End,true).diffDays(o)>=0&&k[r].NextWorkDay!=null&&k[r].LastWorkDay!=null){if(o.diffDays($M(k[r].LastWorkDay,true))<=0&&n.diffDays($M(k[r].NextWorkDay,true))>=0){u.StartDate=k[r].NextWorkDay;u.EndDate=g.EndDate;u.CreationUser=g.CreationUser;u.RealDueDate=g.RealDueDate;u.Delayed=g.Delayed;u.JobTitle=g.JobTitle;u.JobType=g.JobType;u.JobNumber=g.JobNumber;u.ClientNickName=g.ClientNickName;u.ClientDisplayName=g.ClientDisplayName;u.TaskID=g.TaskID;u.TaskNumber=g.TaskNumber;u.Title=g.Title;u.Undisclosed=g.Undisclosed;
u.AbsoluteUserOrder=g.AbsoluteUserOrder;u.EffortEstimation=g.EffortEstimation;if(q==l.length-1){l.push(u);}else{l.splice(q+1,0,u);}g.EndDate=k[r].LastWorkDay;break;}else{if(o.diffDays($M(k[r].Start,true))>=0&&n.diffDays($M(k[r].NextWorkDay,true))>=0){g.StartDate=k[r].NextWorkDay;}}}}}return l;};d.Toggle=function(h){var i=$(h);var j=i.parent();var l=j.parent();var m=!l.hasClass("expanded");l.toggleClass("expanded");if(m){j.css("z-index","10");l.css("z-index","10");l.css("opacity","1");$(i).text("X");var g=$("div.task-container div:nth-last-child(2)",l);d.scrollToElement(g);}else{j.css("z-index","");l.css("z-index","");l.css("opacity","");$(i).text("...");var k=l.parent();d.scrollToElement(k);}};d.ToggleClassContainer=function(g,h){d.Toggle(h.currentTarget);};d.GetLastAvailableDate=function(g){var h=d.GetNextAvailableDate($M(d.Dates()[0].DateCalendar,true),g);ko.utils.arrayForEach(d.Dates(),function(i){var j=$M(i.DateCalendar,true);if(j.diffDays(g)<0){if(i.DailyMinutes>0){h=$M(i.DateCalendar,true);
}}});return h;};d.GetNextAvailableDate=function(i,h){var g=true;var k=$M(i,true).startOfDay();while(g){var j=ko.utils.arrayFirst(d.Dates(),function(l){return k.diffDays($M(l.DateCalendar,true))==0;});if(j==null){g=false;break;}if(j.DailyMinutes>0&&!j.Absent){g=false;}else{k.add(1,"days").startOfDay();}}if(k.diffDays(h)<=0){return k;}else{return null;}};}var AllocationControl=(function(){function a(){this.Container=null;this.viewModel=null;this.defaulMaxVisibleTasks=5;this.selectDateCallback=null;}a.prototype.Init=function(b,c,d,g,f){var e=this;var h="Partials/AllocationControl",i=taskrow.templatePath+h;e.Container=b;Utils.CleanNode(e.Container);if(!c){c=e.defaulMaxVisibleTasks;}e.viewModel=new AllocationViewModel(e.Container,c,d,g,f);e.viewModel.SetupDatePicker();Utils.CleanNode(e.Container);taskrow.LoadTemplate(i,function(j){$(e.Container).html(j({}));ko.applyBindings(e.viewModel,e.Container);$(e.Container).jsScroll();});};a.prototype.SelectDate=function(b){this.viewModel.SelectNewTaskDueDate({DateCalendar:b.toJsonDate()});
};a.prototype.Destroy=function(){Utils.CleanNode(this.Container);};a.prototype.Reset=function(){var b=this;b.viewModel.Clear();$(b.Container).jsScroll();};return a;}());var ContextSearch=(function(){function a(e,b,c,d){this.showInactives=true;this.timesheetSearchDeliverable=false;this.searchTasks=true;this.searchDeliverables=true;this.searchProducts=true;this.searchJobs=true;this.searchClients=true;this.searchSuppliers=false;this.lockSearch=false;this.lockDelete=false;this.searchBox=e;this.context=b;this.originalContext=_.clone(b);this.mode=(!c)?ContextSearchMode.Navigation:c;this.defaultPlaceholder=(!d)?Resources.Commons.Search:d;}a.prototype.SetupContext=function(b){this.context=b;};a.prototype.GetContextQueryString=function(){var b=this.GetContext();var c={};if(b.clientID){c.clientID=b.clientID;}if(b.productID){c.productID=b.productID;}if(b.jobID){c.jobID=b.jobID;}if(b.deliverableID){c.deliverableID=b.deliverableID;}return $.param(c);};a.prototype.GetContext=function(){var b={};for(var c=0;
c<this.context.length;c++){b[this.context[c].Name]=this.context[c].Value;}return b;};a.prototype.GetPrefetchArray=function(){return[];};a.prototype.Unload=function(){var b=this;setTimeout(function(){if($(b.txtBox).attr("typeahead_initialized")){$(b.txtBox).typeahead("destroy");}},10);};a.prototype.FormatURL=function(c){var b=c+"?"+this.GetContextQueryString()+"&q=%QUERY";if(this.showInactives){b+="&showInactives=true";}if(this.timesheetSearchDeliverable){b+="&timesheetSearchDeliverable=true";}return b;};a.prototype.Focus=function(){$(this.txtBox).focus();};a.prototype.SetupAutocomplete=function(){var k=this;var h=0;var m=function(r,p){var q=null;var s=null;if(q=p.TaskNumber){s=URLs.BuildUrl({"Type":(p.IsMember)?"ownedTask":"task",ClientNickName:p.ClientNickName,JobNumber:p.JobNumber,TaskNumber:p.TaskNumber});}else{if(q=p.DeliverableName){s=URLs.BuildUrl({"Type":"deliverable",DeliverableID:p.DeliverableID,ClientNickName:p.ClientNickName,JobNumber:p.JobNumber});}else{if(q=p.JobNumber){s=URLs.BuildUrl({"Type":"job",ClientNickName:p.ClientNickName,JobNumber:p.JobNumber});
}else{if(q=p.ProductName){s=URLs.BuildUrl({"Type":"clientproduct",ClientNickName:p.ClientNickName,ProductID:p.ProductID});}else{if(q=p.ClientNickName){s=URLs.BuildUrl({"Type":"client",ClientNickName:p.ClientNickName});}else{console.log(Resources.Commons.UnknownItem);}}}}}if(k.selectItemCallback&&typeof(k.selectItemCallback)=="function"){k.selectItemCallback(p);}if(q){$(k.txtBox).blur();}if(s){location.href=s;}};var n=function(q,p){setTimeout(function(){k.context.length=0;if(p.TaskNumber){k.context.push(new BreadcrumbItem(p.ClientName,URLs.BuildUrl({"Type":"client",ClientNickName:p.ClientNickName}),"clientID",p.ClientID));if(p.ProductID>0){k.context.push(new BreadcrumbItem(p.ProductName,URLs.BuildUrl({"Type":"clientproduct",ClientNickName:p.ClientNickName,ProductID:p.ProductID}),"productID",p.ProductID));}k.context.push(new BreadcrumbItem(p.JobTitle,URLs.BuildUrl({"Type":"job",ClientNickName:p.ClientNickName,JobNumber:p.JobNumber}),"jobID",p.JobID));k.context.push(new BreadcrumbItem(p.value,URLs.BuildUrl({"Type":"task",ClientNickName:p.ClientNickName,JobNumber:p.JobNumber,TaskNumber:p.TaskNumber}),"taskID",p.TaskID));
}else{if(p.DeliverableTypeID){if(k.searchClients){k.context.push(new BreadcrumbItem(p.ClientName,URLs.BuildUrl({"Type":"client",ClientNickName:p.ClientNickName}),"clientID",p.ClientID));}if(k.searchProducts&&p.ProductID>0){k.context.push(new BreadcrumbItem(p.ProductName,URLs.BuildUrl({"Type":"clientproduct",ClientNickName:p.ClientNickName,ProductID:p.ProductID}),"productID",p.ProductID));}if(k.searchJobs){k.context.push(new BreadcrumbItem(p.JobTitle,URLs.BuildUrl({"Type":"job",ClientNickName:p.ClientNickName,JobNumber:p.JobNumber}),"jobID",p.JobID));}k.context.push(new BreadcrumbItem(p.value,URLs.BuildUrl({"Type":"deliverable",ClientNickName:p.ClientNickName,JobNumber:p.JobNumber,DeliverableID:p.DeliverableID}),"deliverableID",p.DeliverableID));}else{if(p.JobNumber){k.context.push(new BreadcrumbItem(p.ClientName,URLs.BuildUrl({"Type":"client",ClientNickName:p.ClientNickName}),"clientID",p.ClientID));if(p.ProductID>0){k.context.push(new BreadcrumbItem(p.ProductName,URLs.BuildUrl({"Type":"clientproduct",ClientNickName:p.ClientNickName,ProductID:p.ProductID}),"productID",p.ProductID));
}k.context.push(new BreadcrumbItem(p.JobDisplayTitle,URLs.BuildUrl({"Type":"job",ClientNickName:p.ClientNickName,JobNumber:p.JobNumber}),"jobID",p.JobID));}else{if(p.ProductID>0){k.context.push(new BreadcrumbItem(p.ClientName,URLs.BuildUrl({"Type":"client",ClientNickName:p.ClientNickName}),"clientID",p.ClientID));k.context.push(new BreadcrumbItem(p.ProductName,URLs.BuildUrl({"Type":"clientproduct",ClientNickName:p.ClientNickName,ProductID:p.ProductID}),"productID",p.ProductID));}else{if(p.ClientNickName){k.context.push(new BreadcrumbItem(p.value,URLs.BuildUrl({"Type":"client",ClientNickName:p.ClientNickName}),"clientID",p.ClientID));}else{console.log(Resources.Commons.UnknownItem);}}}}}k.SetupULContext();k.SetupAutocomplete();if(k.selectItemCallback&&typeof(k.selectItemCallback)=="function"){k.selectItemCallback(p);}$(k.txtBox).val("");$(k.txtBox).focus();},0);};var l=m;if(k.mode==ContextSearchMode.Selection){l=n;}var g=k.GetContext();var i=[];if(this.searchClients&&!g.clientID){var c=new Bloodhound({datumTokenizer:function(o){return Bloodhound.tokenizers.whitespace(o.value);
},queryTokenizer:Bloodhound.tokenizers.whitespace,local:[],remote:this.FormatURL("/Search/SearchClients")});c.initialize();i.push({name:"Clients"+"_"+this.GetContextQueryString().replace(/[^a-zA-Z0-9]/g,"_"),templates:{suggestion:Handlebars.compile('<p> {{#if Inactive}}<span class="old">{{value}} ['+Resources.Commons.InactiveFemale+"]</span> {{else}} {{value}} {{/if}}</p>"),header:Handlebars.compile("<h3>"+Resources.Commons.Companies+"</h3>")},source:c.ttAdapter()});}if(this.searchSuppliers&&!g.clientID){var c=new Bloodhound({datumTokenizer:function(o){return Bloodhound.tokenizers.whitespace(o.value);},queryTokenizer:Bloodhound.tokenizers.whitespace,local:[],remote:this.FormatURL("/Search/SearchSuppliers")});c.initialize();i.push({name:"Clients"+"_"+this.GetContextQueryString().replace(/[^a-zA-Z0-9]/g,"_"),templates:{suggestion:Handlebars.compile('<p> {{#if Inactive}}<span class="old">{{value}} ['+Resources.Commons.Inactive+"]</span> {{else}} {{value}} {{/if}}</p>"),header:Handlebars.compile("<h3>"+Resources.Supplier.Suppliers+"</h3>")},source:c.ttAdapter()});
}if(this.searchProducts&&!g.productID&&!g.jobID){var e=new Bloodhound({datumTokenizer:function(o){return Bloodhound.tokenizers.whitespace(o.value);},queryTokenizer:Bloodhound.tokenizers.whitespace,local:[],remote:this.FormatURL("/Search/SearchProducts")});e.initialize();i.push({name:"Products"+"_"+this.GetContextQueryString().replace(/[^a-zA-Z0-9]/g,"_"),templates:{suggestion:Handlebars.compile('<p> {{#if Inactive}}<span class="old">{{value}} ['+Resources.Commons.Inactive+"]</span> {{else}} {{value}} {{/if}}</p>"),header:Handlebars.compile("<h3>"+Resources.Product.ProductList+"</h3>")},source:e.ttAdapter()});}if(this.searchJobs&&!g.jobID){var e=new Bloodhound({datumTokenizer:function(o){return Bloodhound.tokenizers.whitespace(o.value);},queryTokenizer:Bloodhound.tokenizers.whitespace,local:[],remote:this.FormatURL("/Search/SearchJobs")});e.initialize();i.push({name:"Jobs"+"_"+this.GetContextQueryString().replace(/[^a-zA-Z0-9]/g,"_"),templates:{suggestion:Handlebars.compile('<p> {{#if Closed}}<span class="old">{{value}} ['+Resources.Job.StatusClosed+"]</span> {{else}} {{value}} {{/if}}</p>"),header:Handlebars.compile("<h3>"+Resources.Commons.Jobs+"</h3>")},source:e.ttAdapter()});
}if(this.searchDeliverables&&!g.deliverableID){var d=new Bloodhound({datumTokenizer:function(o){return Bloodhound.tokenizers.whitespace(o.value);},queryTokenizer:Bloodhound.tokenizers.whitespace,local:[],remote:this.FormatURL("/Search/SearchDeliverables")});d.initialize();i.push({name:"Deliverable"+"_"+this.GetContextQueryString().replace(/[^a-zA-Z0-9]/g,"_"),templates:{suggestion:Handlebars.compile('<p> {{#if Inactive}}<span class="old">{{value}} ['+Resources.Commons.Inactive+"]</span> {{else}} {{value}} {{/if}}</p>"),header:Handlebars.compile("<h3>"+Resources.Commons.Deliverables+"</h3>")},source:d.ttAdapter()});}if(this.searchTasks){var f=new Bloodhound({datumTokenizer:function(o){return Bloodhound.tokenizers.whitespace(o.value);},queryTokenizer:Bloodhound.tokenizers.whitespace,local:[],remote:this.FormatURL("/Search/SearchTasks")});f.initialize();i.push({name:"Tasks"+"_"+this.GetContextQueryString().replace(/[^a-zA-Z0-9]/g,"_"),templates:{suggestion:Handlebars.compile('<p> {{#if Active}} {{#if IsSubtask}}<i class="icon icon-list"></i>{{/if}} {{value}} {{else}} <span class="old">{{#if IsSubtask}}<i class="icon icon-list"></i>{{/if}} {{value}} ['+Resources.Task.Closed+"]</span> {{/if}}</p>"),header:Handlebars.compile("<h3>"+Resources.Commons.Tasks+"</h3>")},source:f.ttAdapter()});
}if($(this.txtBox).attr("typeahead_initialized")){$(this.txtBox).typeahead("destroy");}console.log(["searchs",i]);if(i.length>0){this.lockSearch=false;$(this.txtBox).typeahead({minLength:0,hint:false},i);if(!$(this.txtBox).attr("typeahead_initialized")){$(this.txtBox).attr("typeahead_initialized","true");$(this.txtBox).addListener("typeahead:selected",l);$(this.txtBox).addListener("typeahead:autocompleted",l);}var j=k.defaultPlaceholder;if(this.context.length>0){if(this.searchDeliverables&&!this.searchTasks&&_.any(this.context,function(o){return o.Name=="jobID"&&o.Value>0;})){j=Resources.Commons.Search+" "+Resources.Commons.Deliverables.toLowerCase();}else{j=Resources.Commons.SearchIn+": "+this.context[this.context.length-1].Label;}}$(this.txtBox).attr("placeholder",j);$(this.txtBox).blur(function(){$(this).val("");});}else{this.lockSearch=true;$(this.txtBox).addClass("lockSearch").removeAttr("placeholder");$(this.txtBox).focus();}h=$(this.searchBox).width()-2;$("ul li",this.searchBox).each(function(p,o){h-=$(o).outerWidth(true);
});var b=$("input",this.searchBox);if(b.hasClass("lockSearch")){h-=10;b.css({"margin-left":"10px"});}b.css("min-width","30px");b.width(h-10);};a.prototype.SetupTextboxKeys=function(){var c=$("input",this.searchBox);var b=this;c.addListener("keyup",function(d){if(d.which==8){if(b.lockDelete){d.stopPropagation();d.preventDefault();return;}if(b.context.length>0&&this.oldValue.length==0){setTimeout(function(){var e=_.last(b.context);if(e&&!e.Hide){if(b.context){b.context.pop();}b.SetupULContext();b.SetupAutocomplete();if(b.deleteItemCallback&&typeof(b.deleteItemCallback)=="function"){b.deleteItemCallback(b.context);}}},0);d.stopPropagation();d.preventDefault();}var f=this;f.returning=setTimeout(function(){f.returning=null;$(f).focus();},20);}});c.addListener("keydown",function(d){this.oldValue=this.value;if(b.lockSearch){if(d.which!=8&&d.which!=9){d.stopPropagation();d.preventDefault();}}if(d.which==27){b.context=_.clone(b.originalContext);this.exiting=setTimeout(function(){b.SetupULContext();
b.SetupAutocomplete();if(b.resetContextCallback&&typeof(b.resetContextCallback)=="function"){b.resetContextCallback(b.context);}},0);d.stopPropagation();d.preventDefault();$(this).focus();}else{if(d.which==40){}}});if(b.mode==ContextSearchMode.Navigation){c.blur(function(){if(!this.returning){setTimeout(function(){c.val("");b.context=_.clone(b.originalContext);b.SetupULContext();b.SetupAutocomplete();},1000);}});}};a.prototype.SetupULContext=function(){var e=$("ul",this.searchBox);if(e.length==0){e=$("<ul>");e.appendTo(this.searchBox);}else{e.html("");}e.attr("class","");e.addClass("context").addClass("items-"+this.context.length);if(this.context.length==0){$(this.txtBox).attr("placeholder",this.defaultPlaceholder);}for(var c=0;c<this.context.length;c++){if(!this.context[c].Hide){var d=$("<li>").addClass("step");d.attr("stepname",this.context[c].Name);d.attr("stepvalue",this.context[c].Value);var b=$("<a>");b.html(this.context[c].Label);b.attr("href",this.context[c].URL);if(this.mode==ContextSearchMode.Selection){b.click(function(f){f.stopPropagation();
f.preventDefault();f.cancelBubble=true;return false;});}b.appendTo(d);d.appendTo(e);}}};a.prototype.RefreshContext=function(b){this.SetupContext(b);this.SetupULContext();this.SetupAutocomplete();this.SetupTextboxKeys();};a.prototype.Init=function(){this.SetupULContext();$(this.searchBox).addClass("searchBox");var b=$("<input>").attr("type","text").attr("autocomplete","off").attr("placeholder",Resources.Commons.Search);b.appendTo(this.searchBox);this.txtBox=b[0];this.SetupAutocomplete();this.SetupTextboxKeys();};return a;}());var BreadcrumbItem=(function(){function a(c,e,d,f,b){if(b===void 0){b=false;}this.Label=c;this.URL=e;this.Name=d;this.Value=f;this.Hide=b;}return a;}());var ChartData=(function(){function a(c,b,d){this.data=b;this.options=c;this.reference=d;}return a;}());var ChartHelperStatic=(function(){function a(){this.LoadedAPI=false;this.packages=["corechart","gantt","gauge","timeline","calendar"];}a.prototype.LoadAPI=function(b){var c=this;if(!this.LoadedAPI){google.charts.load("current",{"packages":this.packages,"language":"pt-br"});
google.charts.setOnLoadCallback(function(){c.LoadedAPI=true;});google.charts.setOnLoadCallback(b);}else{if(b){b();}}};a.GetPalette=function(d){var b=["#9CC4E4","#F26C4F","#3A89C9","#4E4D4A","#353432","#94BA65","#2790B0","#1B325F","#E9F2F9"];var c=b.length;return _.map(_.range(d),function(f,e){return{color:b[e%c]};});};a.GetLineChartData=function(h,c,b,d,g){var g=_.extend(g,{title:h,series:a.GetPalette(b.length-1)});var e=[_.clone(c)].concat(_.map(d,function(i){return $.map(b,function(k,j){return j==0?i[k].toString():i[k];});}));var f=google.visualization.arrayToDataTable(e);return new ChartData(g,f);};a.GetGaugeChartData=function(d,e,f,i,g,h){var b=_.map(f,function(k,j){return[k,i[j]];});b.unshift([d,e]);var c=google.visualization.arrayToDataTable(b);return new ChartData(g,c,h);};a.GetGanttChartData=function(b,d,g){var e=d.trackHeight*g.length*1.35;var f={height:e,width:b,gantt:d};var c=new google.visualization.DataTable();c.addColumn("string","Task ID");c.addColumn("string","Task Name");
c.addColumn("string","Resource");c.addColumn("date","Start Date");c.addColumn("date","End Date");c.addColumn("number","Duration");c.addColumn("number","Percent Complete");c.addColumn("string","Dependencies");c.addRows(_.map(g,function(h){return[h.taskID,h.taskName,h.resource,h.startDate,h.endDate,h.duration,h.percentComplet,h.dependencies];}));return new ChartData(f,c);};a.GetTimelineChartData=function(h,g){var b=new google.visualization.DataTable();b.addColumn({type:"string",id:"Term"});b.addColumn({type:"string",id:"Name"});b.addColumn({type:"string",role:"Tooltip"});b.addColumn({type:"date",id:"Start"});b.addColumn({type:"date",id:"End"});b.addRows(_.map(g,function(i){return[i.term,i.name,i.tooltip,i.startDate,i.endDate];}));var f=41;var c=_.unique(g,function(i){return i.term;});var e=c.length;if(h.timeline.groupByRowLabel===false){e=g.length;}var d=(e*f)+(f*3);h.height=d;return new ChartData(h,b);};a.GetCalendarChartData=function(b,d){var c=new google.visualization.DataTable();c.addColumn({type:"date",id:"Date"});
c.addColumn({type:"number",id:"Value"});c.addColumn({type:"string",role:"tooltip",p:{html:true}});c.addRows(_.map(d,function(e){return[e.date,e.value,e.tooltip];}));return new ChartData(b,c);};return a;}());var ChartHelper=new ChartHelperStatic();var DragAndDropContainer=(function(){function a(){this.elements=[];this.movingElements=[];this.dropZones=[];this.ignoreSelfDrop=false;this.mousePos=[0,0];this.movingElementsCount=0;this.preventBeginMove=false;this.pendingRefresh=true;this.offset=[0,0];this.dropPlaceHolders=[];var b=this;$(window).bind("mousemove",function(c){b.UpdateMouseEvents(c.pageX,c.pageY);});$(window).bind("mouseup",function(c){b.preventBeginMove=true;b.EndMove();});b.RefreshDrawing();}a.prototype.AddElement=function(c,e,d){var f=$(c).data("drag-drop-initialized");if(f&&!d){return;}$(c).data("drag-drop-initialized",true);var b=$(c);var h=b.data(a.dragAndDropKey);if(h){h.RemoveElement(c);}b.data(a.dragAndDropKey,this);if(e){$(e,b).off("mousedown").on("mousedown",this.OnHolderMouseDown);
$(e,b).data(a.dragElementKey,b[0]);}else{b.off("mousedown").on("mousedown",function(i){if((i.which&&i.which==1)||(i.button&&i.button==0)){this.OnMouseDown.apply(b,[i,true]);}}.bind(this));}this.elements.push(c);var g=$("<div>",{css:{"width":"calc(100%-30px)","height":b.height()+"px"},"class":"focused-column-indicator"})[0];this.dropPlaceHolders.push(g);};a.prototype.ResetElements=function(b,c){this.elements.length=0;this.dropPlaceHolders.length=0;for(var d=0;d<b.length;d++){this.AddElement(b[d],c,true);}};a.prototype.RemoveElement=function(b){var c=this.elements.indexOf(b);if(c>-1){this.elements.splice(c,1);this.dropPlaceHolders.splice(c,1);}};a.prototype.AddDropZone=function(b,c){var d=$(b).data("drag-drop-initialized");if(d&&!c){return;}$(b).data("drag-drop-initialized",true);this.dropZones.push(b);};a.prototype.ResetDropZones=function(b,d){this.ignoreSelfDrop=d||false;this.dropZones.length=0;for(var c=0;c<b.length;c++){this.AddDropZone(b[c],true);}};a.prototype.BeginMoveElement=function(d,e){var b=$(d);
b.data(a.dragBeginMoveKey,true);var c=$(document).scrollLeft();var j=b.width();var g=b.height();var i={top:b[0].offsetTop-b.parent().scrollTop(),left:b[0].offsetLeft-b.parent().scrollLeft()};b.data(a.dragStartKey,{top:i.top-e.pageY,left:i.left-e.pageX});var f="fake-element-"+Math.random().toFixed(9).replace(".","");$("<div>").css({"opacity":0.5,"width":j+"px","height":g+"px"}).attr("id",f).attr("class",b.attr("class")).insertBefore(b);var h=i.left-c;b.css({"position":"absolute","width":j+"px","height":g+"px","top":i.top+"px","left":h+"px","zIndex":1003}).attr("fakeelementid",f);b.attr("dragged",true);this.TriggerDragStart();};a.prototype.EndMove=function(){this.pendingRefresh=true;this.RefreshDrawing();var g=this;setTimeout(function(){g.TriggerDragEnd();},0);for(var e=this.movingElements.length-1;e>=0;e--){var f=this.elements.indexOf(this.movingElements[e]);var b=$(this.elements[f]);b.removeClass("dragging-element");b.removeData(a.dragBeginMoveKey);var d=b.attr("fakeelementid");if(d){document.getElementById(d).remove();
b.removeAttr("fakeelementid");}var c=this.dropPlaceHolders[f].parentElement;if(c){b[0].parentElement.removeChild(b[0]);this.dropPlaceHolders[f].parentElement.removeChild(this.dropPlaceHolders[f]);$(c).parent().children(".dropZone.column-tasks")[0].appendChild(b[0]);$(c).parent().removeClass("focused-column");setTimeout(function(i,h){g.TriggerDrop(i,h);},0,b[0],c);}b.parent().parent().removeClass("focused-column");this.movingElements.splice(e,1);b.css({"position":"","width":"","height":"","top":"","left":"","zIndex":""});this.DecreaseMoveCount();}};a.prototype.TriggerDragInit=function(){$(this).trigger("taskrow:draginit",{});};a.prototype.TriggerDragStart=function(){$(this).trigger("taskrow:dragstart",{});};a.prototype.TriggerDragEnd=function(){$(this).trigger("taskrow:dragend",{});};a.prototype.TriggerDrop=function(c,b){$(this).trigger("taskrow:drop",{element:c,dropZone:b});};a.prototype.OnHolderMouseDown=function(c){var b=$(this).data(a.dragElementKey);a.prototype.OnMouseDown.apply(b,[c,true]);
};a.prototype.OnMouseDown=function(c,d){var b=$(this);if(!d&&c.target!=this){return;}this.preventBeginMove=false;var e=b.data(a.dragAndDropKey);b.data(a.dragOriginalDropZoneKey,e.GetDropZoneIndex());b.data(a.dragOriginalEventKey,c);b.removeAttr("dragged");e.movingElements.push(b[0]);e.IncreaseMoveCount();e.TriggerDragInit();c.cancelBubble=true;c.stopPropagation();c.preventDefault();return false;};a.prototype.IncreaseMoveCount=function(){this.movingElementsCount++;if(this.movingElementsCount>0){this.RefreshDrawing();}};a.prototype.DecreaseMoveCount=function(){this.movingElementsCount--;};a.prototype.UpdateMouseEvents=function(b,c){if(this.movingElementsCount>0&&(this.mousePos[0]!=b||this.mousePos[1]!=c)){this.pendingRefresh=true;}this.mousePos=[b,c];};a.prototype.RefreshDrawing=function(){if(this.pendingRefresh&&!this.preventBeginMove){var d=$(document).scrollLeft();for(var f=0;f<this.movingElements.length;f++){var b=$(this.movingElements[f]);if(!b.hasClass("dragging-element")){b.addClass("dragging-element");
}var c=b.data(a.dragBeginMoveKey);if(c!==true){var g=b.data(a.dragOriginalEventKey);this.BeginMoveElement(b[0],g);}var e=b.data(a.dragStartKey);b.css({top:(this.mousePos[1]+e.top)+"px",left:(this.mousePos[0]+e.left-d)+"px"});}this.IdentifyDropZones();}this.pendingRefresh=false;this.preventBeginMove=false;requestAnimationFrame(function(){if(this.movingElementsCount>0){this.RefreshDrawing();}}.bind(this));};a.prototype.IdentifyDropZones=function(){var c=0;for(var k=0;k<this.movingElements.length;k++){var m=true;var b=$(this.movingElements[k]);var j=+b.parent().parent().attr("data-step");var d=this.dropPlaceHolders[this.elements.indexOf(this.movingElements[k])];if(this.dropZones.length>0){c=$(this.dropZones[0].offsetParent).offset().top;}var g=this.GetDropZoneIndex();var e=this.dropZones[g];var h=+$(e).parent().attr("data-step");var f=$(e).parent().attr("data-closed")?true:false;var l=!f&&this.ignoreSelfDrop&&(g==b.data(a.dragOriginalDropZoneKey)||j==h);if(g>-1&&!l){if(d.parentElement&&d.parentElement!=e){$(d.parentElement).parent().removeClass("focused-column");
d.parentElement.removeChild(d);}if(!d.parentElement){$(e).parent().addClass("focused-column");e.appendChild(d);}m=false;}if(m&&d.parentElement){$(d.parentElement).parent().removeClass("focused-column");d.parentElement.removeChild(d);}}};a.prototype.GetDropZoneIndex=function(){var i=99999999999;var d=-1;for(var c=0;c<this.dropZones.length;c++){var k=$(this.dropZones[c]);var f=k.offset();var h=[k.width(),k.height()];var g=[0,$(document).scrollTop()];var e=[this.mousePos[0],this.mousePos[1]];if(e[0]+g[0]>f.left&&e[0]+g[0]<=f.left+h[0]&&e[1]>f.top&&e[1]<=f.top+h[1]){var b=Math.sqrt(Math.pow(e[0]+g[0]-f.left,2)+Math.pow(e[0]+g[0]-f.left-h[0],2)+Math.pow(e[1]-f.top,2)+Math.pow(e[1]-f.top+h[1],2));if(b<i){i=b;d=c;}}}return d;};a.prototype.Clear=function(){this.elements.length=0;this.dropPlaceHolders.length=0;this.dropZones.length=0;};a.dragAndDropKey="__drag_and_drop";a.dragStartKey="__drag_start";a.dragElementKey="__drag_element";a.dragOriginalDropZoneKey="__drag_original_dropzone";a.dragOriginalEventKey="__drag_original_event";
a.dragBeginMoveKey="__drag_begin_move";return a;}());UI.DragAndDrop=new DragAndDropContainer();var FormatContent=(function(){function a(c,b){this.activeActions=["bold","insertorderedlist"];this.previousSelectedUserList="";this.mutationObserverConfig={childList:true,characterData:true,subtree:true};this.mentionsEnabled=false;this.keyTimer=null;this.element=c;this.buttonsContainer=b;this.elementScrollHeight=c.scrollHeight;}a.prototype.Init=function(){var b=this;var c=this;c.SetupButtons();c.SetupContentKeys();c.SetupOnChangeHanlder();c.SetupMentionControl();if(!this.element.isContentEditable){this.element.contentEditable="true";}$(c.element).attr("data-formatcontent","true");$(c.element).off("taskrow:commentrefresh").on("taskrow:commentrefresh",function(d){return b.RefreshValueCallback();});c.element.onclick=function(){var d=window.getSelection().getRangeAt(0);c.ParseSelection(d);};$(c.element).addListener("blur",function(){c.WrapLinks();c.TidyHTML();});$(c.element).addListener("focus",function(){if(c.focusCallback){c.focusCallback();
}});this.mutationObserver=new MutationObserver(this.OnElementChanges.bind(this));this.mutationObserver.observe(this.element,this.mutationObserverConfig);};a.prototype.OnElementChanges=function(c,d){var b=false;c.forEach(function(l){var e=$((l.target.nodeType==Node.ELEMENT_NODE)?l.target:l.target.parentElement);var q=e.is(".format-content-mention-word")?e[0]:e.parents(".format-content-mention-word")[0];var p=null;if(q){p=q.parentElement;var w=/([,.-]+)$/gi;var r=q.textContent.replace(w,"");if(l.type=="characterData"&&+q.getAttribute("origintal-text-length")>q.innerHTML.length){var s=q.previousElementSibling;b=true;q.remove();document.execCommand("removeFormat",false);for(var k=p.children.length-1;k>=0;k--){if(p.children[k].innerHTML.trim()==""){p.children[k].remove();document.execCommand("removeFormat",false);}else{break;}}for(var k=0;k<p.children.length;){if(p.children[k].innerHTML.trim()==""){p.children[k].remove();document.execCommand("removeFormat",false);}else{break;}}if(p.children.length==0){p.remove();
document.execCommand("removeFormat",false);}}else{if(l.type=="characterData"&&+q.getAttribute("origintal-text-length")<q.innerHTML.length){var u=[];var x=window.getSelection();var z=x.rangeCount>0?x.getRangeAt(0).startOffset:0;var y=x.rangeCount>0?x.getRangeAt(0).endOffset:z;var h=false;var j=0;for(var k=0;k<p.children.length;k++){if(!h&&q!=p.children[k]){continue;}if(!h&&k>0&&p.children[k-1].innerHTML==" "){u.push(p.children[k-1]);j=1;}h=true;u.push(p.children[k]);}b=true;if(u.length==1&&r.length==+q.getAttribute("origintal-text-length")){var v=w.exec(q.textContent)[1];q.innerHTML=r;q.insertAdjacentHTML("afterend",v);}else{$(u).remove().removeClass("format-content-mention-word").each(function(m,i){if(m>0||q.innerHTML[0]!=" "){i.innerHTML=i.innerHTML+" ";}}).insertAfter(p);document.execCommand("removeFormat",false);p.insertAdjacentHTML("afterend"," ");if(q.innerHTML[0]==" "){q.innerHTML=q.innerHTML.substr(1);z--;y--;}UI.Focus.SetAtNode(q.childNodes[0],z,y);}}}}else{if(e.is(".format-content-mention")){p=e[0];
var o=p.childNodes;for(var k=o.length-1;k>=0;k--){if(o[k].nodeType!=Node.ELEMENT_NODE||!$(o[k]).hasClass("format-content-mention-word")){var t=o[k];p.removeChild(o[k]);document.execCommand("removeFormat",false);var g;if(t.nodeType!=Node.ELEMENT_NODE){p.insertAdjacentHTML("afterend",t.textContent);g=p.nextSibling;}else{$(t).insertAfter(p);g=t.childNodes[0];}UI.Focus.SetAtNode(g,1);b=true;}}}else{if(Utils.IsChrome()&&l.addedNodes&&l.addedNodes.length){var n=false;var f;for(var k=0;k<l.addedNodes.length;k++){if(l.addedNodes[k].nodeType==Node.ELEMENT_NODE){f=l.addedNodes[k];}else{continue;}if(f.tagName==="FONT"&&f.getAttribute("color")=="#ff3300"){var A=document.createTextNode(f.textContent);f.parentNode.replaceChild(A,f);UI.Focus.SetAfterNode(A);n=true;}}if(n){document.execCommand("removeFormat",false);}}}}});if(b){this.RefreshValueCallback();}};a.prototype.AddTemplateList=function(e,m){var g=(m)?"Selecione um template":Resources.TaskTemplate.Templates;if(e&&e.length>0){var h=this;var l=$(this.element).parent().find(".templateList");
if(l.length==0){l=$("<div>",{"class":"templateList float-list"}).insertAfter(this.element);}l.children().remove();var b=$("<i>",{"class":"caret"}).appendTo(l);var f=$("<span>",{text:g}).appendTo(l);l.bind("click",function(){var i=$(this);if(i.hasClass("open")){return;}i.addClass("open");if(e.length>8){$("ul",i).jsScroll();}setTimeout(function(){$(document).one("click",function(){i.removeClass("open");});},0);});var c=$("<ul>").appendTo(l);if(!m){e.unshift({Title:Resources.TaskTemplate.SelectTemplate,Content:""});}for(var d=0;d<e.length;d++){var j=e[d];var k=$("<li>",{"html":e[d].Title});k[0]["templateContent"]=e[d].Content;k[0]["templateData"]=e[d];k.bind("click",function(i){f.text(this.templateData?(this.templateData.Title||g):g);h.ApplyTemplate(this.templateContent,false);$(h).trigger("templateselected",this.templateData);});k.appendTo(c);}this.element.style.marginTop="32px";if(m){$(l).click();}}else{var l=$(this.element).next(".templateList");l.remove();this.element.style.marginTop="";
}UI.TriggerModalBodyResize();};a.prototype.ApplyTemplate=function(d,b){var c=this;this.element.innerHTML=d.trim()+this.element.innerHTML;if($(".editable",this.element).length>0){this.element.contentEditable="false";}$(".editable",this.element).each(function(e){this.contentEditable=true;this.innerHTML="?";this.tabIndex=e;$(this).blur(function(){if(!/[^ ]+/gi.test(this.innerHTML)){this.innerHTML="?";}});$(this).keypress(function(f){if(f.which==9&&c.element.isContentEditable){f.preventDefault();}});});this.ElementOnChange(null);};a.prototype.SelectNodes=function(k,h){var e=[];var g=[];var l=new RegExp(h,"gi");e.push(k);for(var c=0;c<e.length;c++){var n=e[c];if(n.nodeType==3){var f=null;while(f=l.exec(n.textContent)){var m=f[0];g.push({node:n,start:f.index,end:f.index+m.length,content:m});}}else{var b=n.childNodes;if(!b){continue;}for(var d=0;d<b.length;d++){e.push(b[d]);}}}return g;};a.prototype.Focus=function(){var b=this.element;$(b).focus();b.innerHTML="\u00a0"+b.innerHTML;UI.Focus.SelectNodeContent(b);
document.execCommand("delete",false,null);};a.prototype.TidyHTML=function(){var g=$("*",this.element);var e=UI.GetAllowedCSSAttributesDictionary();var j=UI.GetAllowedHTMLElementsDictionary();for(var h=0;h<g.length;h++){var f=g[h];if(!UI.IsInDOMTree(f)){continue;}if(f.tagName&&!j[f.tagName.toLocaleLowerCase()]){f.remove();}var d=f.getAttribute("class")||"";d=d.split(" ").filter(function(i){return i.indexOf("format-content-")==0;}).join(" ");if(d==""){f.removeAttribute("class");}else{if(f.getAttribute("class")!=d){f.setAttribute("class",d);}}f.removeAttribute("data-bind");f.removeAttribute("contenteditable");f.removeAttribute("id");if(f.tagName.toLocaleLowerCase()=="a"){f.setAttribute("target","_blank");console.log("link",f);}var c=f.style.cssText.split(";").map(function(i){return({"cssKey":_.trim(i.split(":")[0]),"cssValue":i.split(":")[1]});});var b=c.filter(function(i){return e[i.cssKey];}).map(function(i){return i.cssKey+": "+i.cssValue;}).join("; ");f.style.cssText=b;}};a.prototype.WrapLinks=function(){$("wbr",this.element).remove();
this.element.normalize();var c=this.SelectNodes(this.element,"https?://[^ \t\r\n]+");for(var b=0;b<c.length;b++){var e=$(c[b].node).parents(":not(:has([data-formatcontent]))");if(e.is("a")){if(e[0].tagName.toLowerCase()=="a"&&c[b].node.textContent!=e[0].getAttribute("href")&&(c[b].node.textContent).indexOf("http")==0&&(e[0].getAttribute("href")).indexOf("http")==0){e[0].setAttribute("href",c[b].node.textContent);}continue;}var f=document.createRange();f.setStart(c[b].node,c[b].start);f.setEnd(c[b].node,c[b].end);var d=$("<a>",{"target":"_blank","href":c[b].content})[0];f.surroundContents(d);}if(c.length>0){this.RefreshValueCallback();}};a.prototype.SetupMentionControl=function(){var b=this;if(!this.mentionsEnabled){return;}var c="content-editable-container-"+Math.floor(Math.random()*9999999);$(this.element.parentElement).addClass(c);taskrow.ListUsers(function(d){$(b.element).textcomplete([{match:/(^|\s)(@[A-zÀ-ÿ]*)$/,search:function(g,e){if(!g){return;}var f=_(d).filter(function(h){return Utils.RemoveAccents(h.UserLogin).indexOf(Utils.RemoveAccents(g.substring(1)))>=0;
});e(f,false);},replace:function(e){return'$1<span class="format-content-mention" data-userid="'+e.UserID+'">'+e.UserLogin.split(" ").map(function(f){return'<span class="format-content-mention-word" origintal-text-length="'+f.length+'" readonly="true">'+f+"</span>";}).join('<span class="format-content-mention-word" origintal-text-length="1" readonly="true"> </span>')+"</span> ";},template:function(f,e){return f.UserLogin.replace(new RegExp(e,"gi"),"<b>"+e+"</b>");}}],{appendTo:"."+c}).on("textComplete:select",function(f){return b.RefreshValueCallback();});});};a.prototype.SetupOnChangeHanlder=function(){var d=this;var c=false;var b=d.element;if(!("oninput" in b)||navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident")>=0){b.addEventListener("DOMCharacterDataModified",function(f){d.ElementOnChange.apply(d,[f]);},false);}else{b.addEventListener("input",function(f){d.ElementOnChange.apply(d,[f]);},false);}};a.prototype.SetupButtons=function(){var d=this;var b=$("a[data-action], button[data-action]",$(d.buttonsContainer));
for(var c=0;c<b.length;c++){$(b[c]).off("click").on("click",function(g){var f=this;if($.inArray($(f).data("action"),d.activeActions)>-1){$(f).toggleClass("active");}document.execCommand($(f).data("action"),false,$(f).data("value"));$(f).blur();$(d.element).focus();g.preventDefault();g.stopPropagation();return false;});}};a.prototype.GetContent=function(){var b=$("<div>");this.TidyHTML();b.html(this.element.innerHTML);$(".editable",b).each(function(c){this.contentEditable="inherit";});return b.html();};a.prototype.GetSelectedUsers=function(){var c=$("span[data-userid]",this.element);var b=c.map(function(e,d){return +(d.getAttribute("data-userid"));});return Array.prototype.splice.apply(_.uniq(b),[0]);};a.prototype.RefreshValueCallback=function(){var d=this;if(d.changeValueCallback&&typeof(d.changeValueCallback)){d.changeValueCallback(this.GetContent());}var b=this.GetSelectedUsers();var c=b.join(",");if(this.previousSelectedUserList!=c&&d.changeUsersCallback&&typeof(d.changeUsersCallback)){d.changeUsersCallback(b);
}this.previousSelectedUserList=c;};a.prototype.ElementOnChange=function(b){var c=this;if(c.elementScrollHeight!=c.element.scrollHeight){c.elementScrollHeight=c.element.scrollHeight;if($(c.element).outerHeight()<c.element.scrollHeight){$(c.element).jsScroll();}}c.RefreshValueCallback();};a.prototype.SetupContentKeys=function(){var b=this;$(b.element).keydown(function(c){if(c.keyCode==13){$(b).trigger("taskrow:enter",c);}if(c.keyCode==9){if(window.getSelection()&&window.getSelection().type=="Range"){if(document.getSelection().getRangeAt(0).cloneContents().textContent.length>0){document.execCommand((c.shiftKey?"outdent":"indent"),false,null);c.preventDefault();c.stopPropagation();}}}if(b.keyTimer){clearTimeout(b.keyTimer);}b.keyTimer=window.setTimeout(function(){if(window.getSelection()&&window.getSelection().type=="Range"){var d=window.getSelection().getRangeAt(0);b.ParseSelection(d);}b.keyTimer=null;},200);});};a.prototype.ParseSelection=function(e){var f=this;var b=$("a[data-action=bold],button[data-action=bold]",$(f.buttonsContainer))[0];
var c=$("a[data-action=insertorderedlist],button[data-action=insertorderedlist]",$(f.buttonsContainer))[0];var g=e.startContainer.tagName?e.startContainer.tagName:"";var d=e.startContainer.parentNode.tagName?e.startContainer.parentNode.tagName:"";if(b){if(g.toUpperCase()=="B"||d.toUpperCase()=="B"){$(b).addClass("active");}else{$(b).removeClass("active");}}if(c){if(g.toUpperCase()=="LI"||d.toUpperCase()=="LI"||g.toUpperCase()=="OL"||d.toUpperCase()=="OL"){$(c).addClass("active");}else{$(c).removeClass("active");}}};a.prototype.ClearContent=function(){this.element.innerHTML="";};return a;}());(function(a,g,c,f){var e="imageGallery",b={containerClass:""};function d(h,i){this.element=h;this.options=a.extend({},b,i);if(!this.options.moduleContainer){throw ("ModuleContainer obrigatorio");}this._defaults=b;this._name=e;this.init();}d.prototype={init:function(){var p=this,j,k,m,l,n;a(this.element).addClass(this.options.containerClass);a("img",this.element).click(function(){p.open(a(this).data("image-url"),a(this).data("download"));
});if(a(".imageGalleryModal").size()>0){j=a(".imageGalleryModal");a(".close",j).unbind("click").click(function(){p.close();});return;}a("<div/>",{"class":"imageGalleryModal",css:{"background-color":"rgba(256, 256, 256, 0.9)",display:"none",position:"fixed",top:0,left:0,bottom:0,right:0,"z-index":9999}}).appendTo("body");j=a(".imageGalleryModal");var h=a("<button/>",{"class":"close",type:"button",on:{click:function(){a(p.element).imageGallery("close");}}});a("<i>",{"class":"icon icon-close"}).appendTo(h);h.appendTo(j);a("<div/>",{"class":"imageGalleryNavigation"}).appendTo(j);k=a(".imageGalleryNavigation");a("<div/>",{"class":"imageGalleryNavigation-wrap"}).appendTo(k);m=a(".imageGalleryNavigation-wrap");a("<div/>",{"class":"imageGalleryNavigation-inner"}).appendTo(m);l=a(".imageGalleryNavigation-inner");var o=a("<div/>",{"class":"imageGalleryView",css:{"background-position":"center center","background-repeat":"no-repeat","background-size":"contain",position:"fixed",top:"110px",left:"20px",bottom:"10px",right:"20px"}});
var i=a("<a/>",{"class":"btn btn-default download",href:"#",css:{"z-index":9999,position:"fixed",display:"inline-block",top:"102px",right:"5px",width:"80px"}});a("<span/>",{css:{"margin-right":"5px"}}).text(Resources.Commons.Download).appendTo(i);a("<i>",{"class":"icon icon-cloud-download"}).appendTo(i);i.appendTo(o);o.appendTo(j);p.configSlider();},fillModal:function(n,k,m){var o=this,i=a(".imageGalleryModal .imageGalleryNavigation-inner"),h=a("li",o.element),j=a(".imageGalleryView"),l=(154*h.size()),n=n||h.eq(0).children("img").data("image-url"),k=k||h.eq(0).children("img").data("download");i.width(l).empty();i.css({"transition":"none","transform":"translateX(0px)"}).delay(300).queue(function(){a(this).css({"transition":"transform 1s ease-in-out 0s"});});h.each(function(r,q){var p=a("img",q);p.clone().removeAttr("data-bind").click(function(){o.showImage(p.data("image-url"),p.data("download"),true);}).appendTo(i).wrap(a("<span>",{"class":"image"})).after(a("<a/>",{"class":"btn btn-download",html:a("<i/>",{"class":"icon icon-cloud-download"}),href:p.data("download")}));
});o.showImage(n,k,m);},showImage:function(k,i,j){var l=this;this.options.moduleContainer.DisplayLoading();a(".imageGalleryModal .imageGalleryNavigation-wrap img").each(function(){if(a(this).parent().is(".selected")){a(this).unwrap();}});a(".imageGalleryModal [data-image-url='"+k+"']").wrap("<span class='selected'></span>");var h=a(".imageGalleryView");a("a.btn.download",h).attr("href","#").hide();a("<img/>").addListener("load",function(){h.css("background-image","url("+k+")");a("a.btn.download",h).attr("href",i).show();if(!j){l.slideToImage(k);}l.options.moduleContainer.HideLoading();}).attr("src",k);},configSlider:function(){var h=a(".imageGalleryNavigation");var i=this;a("<button/>",{"class":"btn prev",type:"button",on:{click:function(){i.sliderNavigation("prev");}},html:a("<i/>",{"class":"icon icon-angle-double-left icon-double-angle-left"})}).prependTo(h);a("<button/>",{"class":"btn next",type:"button",on:{click:function(){i.sliderNavigation("next");}},html:a("<i/>",{"class":"icon icon-angle-double-right icon-double-angle-right"})}).appendTo(h);
},slideToImage:function(m){var h=a(".imageGalleryModal [data-image-url='"+m+"']").parent().parent();var j=a(".imageGalleryNavigation-wrap"),i=a(".imageGalleryNavigation-inner",j),k=a(".image",i),u=j.width(),n=k.width(),t=Math.floor(u/n),s=0;var l=k.index(h);if(l>-1&&l>=t){var p=Math.ceil((l+1)/t);var q=(t*n);var r=q*(p-1);r=Math.abs(r);var o=i.width();if(r>(o-u)){s=(o-u);}else{s=r;}}s=s*-1;i.css({"transition":"none","transform":"translateX("+s+"px)"}).delay(300).queue(function(){a(this).css({"transition":"transform 1s ease-in-out 0s"});});},sliderNavigation:function(l){var i=a(".imageGalleryNavigation-wrap"),h=a(".imageGalleryNavigation-inner",i),j=a(".image",h),k=g.getComputedStyle(h[0],null),o=k.getPropertyValue("transform")||k.getPropertyValue("-webkit-transform")||k.getPropertyValue("-moz-transform")||k.getPropertyValue("-ms-transform")||k.getPropertyValue("-o-transform"),p=o.substring(7,o.length-1).split(", "),q=+p[4],t=i.width(),n=h.width(),m=j.width(),s=Math.floor(t/m),r=0;if(j.length<=s){return;
}q=Math.abs(q);if(l=="next"){if(q+s*m+t>n){r=(n-t);}else{r=(q+s*m);}}else{if(l=="prev"){if(q-s*m<0){r=0;}else{r=(q-s*m);}}}r=r*-1;h.css({"transition":"transform 1s ease-in-out 0s","transform":"translateX("+r+"px)"});},open:function(j,h,i){var k=this;a(".imageGalleryModal").show();a(".imageGalleryView").css("background-image","url()");this.fillModal(j,h,i);a(g).bind("keydown",k.closeOnEsc);},close:function(){var h=this;a(".imageGalleryView").css("background-image","url()");a(".imageGalleryModal").hide();a(g).unbind("keydown",h.closeOnEsc);},closeOnEsc:function(h){var i=this;if((h.keyCode||h.which)===27){a(".imageGalleryView").css("background-image","url()");a(".imageGalleryModal").hide();a(g).unbind("keydown",i.closeOnEsc);}},reset:function(h){var i=this;a("img",this.element).unbind("click").click(function(){i.open(a(this).data("image-url"),a(this).data("download"));});},destroy:function(){var h=a(".imageGalleryModal");if(h){h.remove();}}};a.fn[e]=function(){var i=Array.prototype.splice.apply(arguments,[0]);
if(i[0]&&typeof(i[0])=="string"){var h=i.splice(1);return this.each(function(){a.data(this,"plugin_"+e)[i[0]].apply(a.data(this,"plugin_"+e),h);});}else{return this.each(function(){if(!a.data(this,"plugin_"+e)){a.data(this,"plugin_"+e,new d(this,i[0]));}});}};})(jQuery,window,document);(function(a){a.fn.dropArea=function(){var n=null;var l="";var o=[];if(arguments.length>=1&&typeof(arguments[0])=="object"){n=arguments[0];}else{if(arguments.length>=1&&typeof(arguments[0])=="string"){l=arguments[0];o=arguments[1];}}var k=function(y){if(console){console.log(y);}};var e={extensions:environmentData["AllowerdAttachmentsExtensions"],chunkSize:1024*768,maxFileSize:1024*1024*20,maxTotalSize:1024*1024*20,totalFiles:10,entireFileURL:"",partFileURL:"",fileAddedEvent:a.noop,filePartReadyEvent:a.noop,fileProgressEvent:a.noop,formatDenyMessage:Resources.JqueryDropAreaMessages.ExtensionNotAllowed,denyLargeFile:Resources.JqueryDropAreaMessages.SizeNotAllowed,enablePasteImage:true,pasteMatchType:/image.*/,pasteImageNameDefault:Resources.JqueryDropAreaMessages.Attachment.toLowerCase(),totalFileSize:0,error:function(y){UI.Alert(y);
}};var d=function(){var y=a(this);m.DestroyOverlay.apply(y[0]);y[0]["dropAreaOverlay"]=a("<div>").attr("id","dropOverlay_"+y[0].id).addClass("dropOverlay");var z=a("<div>").addClass("area1");var A=a("<div>").addClass("area2");var B=a("<div>").addClass("area3").html(Resources.TaskAttachment.DropFilesHere);B.appendTo(A);A.appendTo(z);z.appendTo(y[0]["dropAreaOverlay"]);y[0]["dropAreaOverlay"][0].contentArea=this;y[0]["dropAreaOverlay"].css("height",(y.parent().outerHeight()+2)+"px").css("width",(y.parent().outerWidth()+2)+"px").css("left",y.parent()[0].offsetLeft).css("top",y.parent()[0].offsetTop);var D="auto";var C=y;while(!C.is("body")&&D=="auto"){D=C.css("z-index");C=C.parent();}y[0]["dropAreaOverlay"].css("z-index",(D=="auto")?999:parseInt(D)+1);y[0]["dropAreaOverlay"].css("display","none");y[0]["dropAreaOverlay"].insertAfter(y.parent());y[0]["dropAreaOverlay"].addListener("drop",function(E){g.dropArea_drop.apply(y[0],[E]);});};var t=function(){var y=a(this);if(y.hasClass("dragging")){return;
}a(y[0]["dropAreaOverlay"]).css("height",(y.parent().outerHeight()+2)+"px").css("width",(y.parent().outerWidth()+2)+"px").css("left",y.parent()[0].offsetLeft).css("top",y.parent()[0].offsetTop);y[0]["dropAreaOverlay"].css("display","table");y.addClass("dragging");};var j=function(){var y=a(this);a(".dropOverlay").css("display","none");a(".dropOverlay").each(function(z,A){a(A["contentArea"]).removeClass("dragging");});};var f=null;var g={document_dragEnter:function(z){var y=a(this);z.preventDefault();if(f!=null){clearTimeout(f);f=null;}t.apply(y[0]);},document_dragOver:function(z){var y=a(this);z.preventDefault();if(f!=null){clearTimeout(f);f=null;}t.apply(y[0]);},document_dragLeave:function(z){var y=a(this);z.preventDefault();if(f==null){f=setTimeout(function(){j.apply(y[0]);},100);}},document_drop:function(z){var y=a(this);z.preventDefault();if(f==null){j.apply(y[0]);}},dropArea_drop:function(z){var y=a(this);z.stopPropagation();z.preventDefault();if(f==null){j.apply(y[0]);}h.apply(this,[z]);
return false;},element_change:function(y){if(a(y.currentTarget).hasClass("paste_pasted")){a(y.currentTarget).addClass("paste_changed");a(y.currentTarget).removeClass("paste_pasted");}},element_paste:function(B){var y=a(this);var C=null;var A=this;a(B.currentTarget).addClass("paste_pasted");var z=null;if(B&&B.clipboardData&&B.clipboardData.types){z=B.clipboardData;}else{if(B&&B.originalEvent&&B.originalEvent.clipboardData&&B.originalEvent.clipboardData.types){z=B.originalEvent.clipboardData;}else{if(window["clipboardData"]&&window["clipboardData"].types){z=window["clipboardData"];}else{k("no clipboardData access");}}}if(z!=null&&z.types&&z.types.length>0){var D=false;Array.prototype.forEach.call(z.types,function(F,E){if(D){return;}if(z.items==null||z.items.length==0){return;}if(!F.match(n.pasteMatchType)&&z.items&&!z.items[E].type.match(n.pasteMatchType)){return;}C=z.items[E].getAsFile();D=true;});if(C!=null){B.preventDefault();B.stopPropagation();v.call(A,[C],function(F){var E=function(H){var I=a("<img>",{processed:"true",GUID:F[0],src:H,css:{width:"250px"}});
var K=document.defaultView.getSelection();var J=K.getRangeAt(0);J.insertNode(I[0]);y.trigger("taskrow:commentrefresh");};var G=new FileReader();G.onload=function(H){E(H.target["result"]);};G.readAsDataURL(C);});}}else{i(this,B,function(G){try{var H=(new RegExp('data:([^;]+);base64,([^"]+)')).exec(a(G).attr("src"));if(!H||H.length<3){console.log("imagem não é base64",a(G).attr("src"));return;}var F=Utils.DecodeBase64(H[2]);C=new Blob([F],{type:H[1]});if(!C){console.log("Não deu para decodar base64");return;}v.call(A,[C],function(I){a(G).attr("GUID",I[0]);});}catch(E){console.log("Algum erro diferentão",E);}});}}};var i=function(A,z,y){x(A,function(B){y(B);});};var u=5,c=0;var x=function(z,y){if(a(z).hasClass("paste_changed")){var A=a(z).find("img:not([processed=true])");if(A.length>0){Array.prototype.forEach.call(A,function(D,C){y(D);a(D).attr("processed","true");});}a(z).removeClass("paste_changed");}else{c++;var B={e:z,c:y,callself:function(){x(B.e,B.c);}};if(c<u){setTimeout(B.callself,20);
}else{a(z).removeClass("paste_pasted");}}};var h=function(z){var A=this;var y=a(this);var B=null;if(z&&z.originalEvent&&z.originalEvent.dataTransfer){B=z.originalEvent.dataTransfer.files;}else{if(z&&z.dataTransfer){B=z.dataTransfer.files;}else{k("no dragevent access");}}if(B){v.apply(A,[B]);}};var p=[];var v=function(R,A){var E=this;var y=a(this);if(!y[0]["UploadFiles"]){y[0]["UploadFiles"]={};}var K=new Array();var F=new Array();var U=false;var V=false;var B=false;var I=new Array();var J=new Array();var M=[];var T=R.length;for(var N=0,C;C=R[N];N++){var X=0;var Z=0;for(var P in y[0]["UploadFiles"]){X++;Z+=parseInt(y[0]["UploadFiles"][P].data.size,10);}if(U||X>=y[0]["dropAreaOptions"].totalFiles){K.push(C);U=true;T--;continue;}if(V||(Z+C.size)>y[0]["dropAreaOptions"].maxTotalSize){K.push(C);V=true;T--;continue;}if(y[0]["dropAreaOptions"].extensions.length>0&&C.name!=undefined){var z=false;var S=new RegExp("(.*\\."+y[0]["dropAreaOptions"].extensions.join(")|(.*\\.")+")");z=S.test(C.name.toLowerCase());
if(!z){I.push(C);T--;continue;}}if(C.name===undefined){var D=($M!=null)?$M().format("DD-MM-YYYY"):[new Date().getDate(),new Date().getMonth()+1,new Date().getFullYear()].join("-");C.name=[[y[0]["dropAreaOptions"].pasteImageNameDefault,D].join("-"),C.type.split("/")[1]].join(".");}C.name=C.name.replace(/\"/gi,"");if(!C.size){F.push(C);T--;continue;}if(C.size>y[0]["dropAreaOptions"].maxFileSize){J.push(C);T--;continue;}var L=Utils.GuidGenerator();M.push(L);var Y=1;if(y[0]["dropAreaOptions"].partFileURL!=""){Y=parseInt((C.size/y[0]["dropAreaOptions"].chunkSize).toString(),10);Y=(C.size%y[0]["dropAreaOptions"].chunkSize>0)?(Y+1):Y;}y[0]["dropAreaOptions"].totalFileSize=Y*100;y[0]["UploadFiles"][L]={"data":C,"uploadedParts":{}};y[0]["UploadFiles"][L].uploadedParts.length=Y;for(var O=0;O<Y;O++){y[0]["UploadFiles"][L].uploadedParts[O]={};}var W=new FileReader();W.onerror=function(aa){y[0]["dropAreaOptions"].error("FileReader error code: "+aa.target.error.code);};W.onload=(function(ac,aa,ab){var ad=ac.name.split(".")[ac.name.split(".").length-1];
var ae=(C.type==="")?b(ad):C.type;return function(ah){var ag=Math.floor(Math.random()*31);ag=Math.floor(Math.random()*2)?ag:-ag;var af={"fullName":ac.name,"name":ac.name.substring(0,ac.name.lastIndexOf(".")),"ext":ad,"src":ah.target.result,"fileSize":ac.size,"type":ae,"rotate":ag,"GUID":aa,"maxProgressBar":ab*100};y[0]["dropAreaOptions"].fileAddedEvent.call(E,af);T--;if(T==0){s();}};})(C,L,Y);W.readAsDataURL(C);p.push({dropArea:E,args:[C,L,Y]});}if(A&&typeof A=="function"){A(M);}var G="";if(U){var Q="";for(var N=0,H;H=K[N];N++){Q=Q+"<br/> - "+H.name;}G+=Resources.JqueryDropAreaMessages.FilesLimitExceeded+" ("+y[0]["dropAreaOptions"].totalFiles.toString()+") :"+Q;}else{if(V){var Q="";for(var N=0,H;H=K[N];N++){Q=Q+"<br/> - "+H.name;}G+=Resources.JqueryDropAreaMessages.FilesSizeExceeded+" ("+(y[0]["dropAreaOptions"].maxTotalSize/(1024*1024))+"mb) :"+Q;}}if(I&&I.length>0){var Q="";for(var N=0,H;H=I[N];N++){Q=Q+"<br/> - "+H.name;}if(G.length>0){G+="<br/><br/>";}G+="Arquivos não adicionados pois "+Resources.JqueryDropAreaMessages.ExtensionNotAllowed.toLowerCase()+" :"+Q;
}if(J&&J.length>0){var Q="";for(var N=0,H;H=J[N];N++){Q=Q+"<br/> - "+H.name;}if(G.length>0){G+="<br/><br/>";}G+="Arquivos não adicionados pois "+Resources.JqueryDropAreaMessages.SizeNotAllowed.toLowerCase()+" ("+(y[0]["dropAreaOptions"].maxFileSize/(1024*1024))+"mb) :"+Q;}if(F&&F.length>0){var Q="";for(var N=0,H;H=F[N];N++){Q=Q+"<br/> - "+H.name;}if(G.length>0){G+="<br/><br/>";}G+="Arquivos não adicionados pois estão vazios (0 bytes):"+Q;}if(G&&G.length>0){y[0]["dropAreaOptions"].error(G);}};var r=false;var s=function(){if(r||p.length==0){return;}r=true;var y=p[p.length-1];p.length=p.length-1;w.apply(y.dropArea,y.args);};var w=function(z,E,I){var y=a(this);if(y[0]["dropAreaOptions"].partFileURL==""&&y[0]["dropAreaOptions"].entireFileURL==""){k(Resources.JqueryDropAreaMessages.NoURLConfigured);return;}var G=z.size;var F=1;var H=0;var B=z.size;var J=y[0]["dropAreaOptions"].entireFileURL;if(y[0]["dropAreaOptions"].partFileURL!=""){B=y[0]["dropAreaOptions"].chunkSize;J=y[0]["dropAreaOptions"].partFileURL;
}var C=z.name.split(".")[z.name.split(".").length-1];var D=(z.type==="")?b(C):z.type;while(H<G){if("slice" in z){var A=z.slice(H,B);}else{if("mozSlice" in z){var A=z.mozSlice(H,B);}else{var A=z.webkitSlice(H,B);}}q.apply(this,[J,E,F,z.name,D,z.size,I,A]);F++;H=B;B=H+y[0]["dropAreaOptions"].chunkSize;}};var q=function(I,B,D,C,G,E,F,z){var A=this;var y=a(this);var J=new XMLHttpRequest();var H=I+(I.indexOf("?")>-1?"&":"?")+"guid="+B+"&part="+D+"&fileName="+encodeURIComponent(C)+"&fileType="+G+"&fileSize="+E+"&totalParts="+F;J.open("POST",H,true);J.onload=function(K){if(!y[0]["UploadFiles"][B]||y[0]["UploadFiles"][B]==null||y[0]["UploadFiles"][B]==undefined){return;}y[0]["UploadFiles"][B].uploadedParts[D-1].percent=100;var N=0;for(var L=0;L<y[0]["UploadFiles"][B].uploadedParts.length;L++){N+=(y[0]["UploadFiles"][B].uploadedParts[L].percent)||0;}var O=a("#progress"+B);O.attr("value",N);if(O.attr("value")==O.attr("max")){a("#status"+B).removeClass("hide");O.addClass("hide");}var M=(N/y[0]["dropAreaOptions"].totalFileSize)*100;
y[0]["dropAreaOptions"].fileProgressEvent.call(A,B,M);};J.upload.onprogress=function(K){if(K.lengthComputable){if(!y[0]["UploadFiles"][B]||y[0]["UploadFiles"][B]==null||y[0]["UploadFiles"][B]==undefined){return;}y[0]["UploadFiles"][B].uploadedParts[D-1].percent=((K.loaded/K.total)*100);var N=0;for(var L=0;L<y[0]["UploadFiles"][B].uploadedParts.length;L++){N+=(y[0]["UploadFiles"][B].uploadedParts[L].percent)||0;}a("#progress"+B).attr("value",N);var M=(N/y[0]["dropAreaOptions"].totalFileSize)*100;y[0]["dropAreaOptions"].fileProgressEvent.call(A,B,M);}};J.onerror=function(K){a("#progress"+B).addClass("error");};J.onreadystatechange=function(){if(J.readyState!=4){return;}if(J.status!=200){y[0]["UploadFiles"][B].uploadedParts[D-1].complete=false;return;}var L=JSON.parse(J.responseText);y[0]["UploadFiles"][B].uploadedParts[D-1].complete=true;var M=false;for(var K=0;K<y[0]["UploadFiles"][B].uploadedParts.length;K++){if(y[0]["UploadFiles"][B].uploadedParts[K].complete===undefined||y[0]["UploadFiles"][B].uploadedParts[K].complete===null){M=true;
break;}}if(!M){y[0]["UploadFiles"][B].finished=true;r=false;s();}y[0]["dropAreaOptions"].filePartReadyEvent.call(A,L);};J.send(z);};var m={option:function(z){var y=a(this);if(y[0]["dropAreaOptions"]){if(y[0]["dropAreaOptions"][z]){return y[0]["dropAreaOptions"][z];}else{k("property "+z+" invalid");}}else{UI.Alert(Resources.JqueryDropAreaMessages.PropertiesNotLoaded);}},UploadFiles:function(y){v.apply(this,[y]);},CheckFilesAreReady:function(){var y=a(this);var A=true;for(var z in y[0]["UploadFiles"]){if(y[0]["UploadFiles"][z].finished===undefined||y[0]["UploadFiles"][z].finished===null){A=false;break;}if(!A){break;}}return A;},GetFileGUID:function(){var y=a(this);var z=new Array();for(var A in y[0]["UploadFiles"]){z.push(A);}return z.toString();},Count:function(){var y=a(this);return _.keys(y[0]["UploadFiles"]).length;},GetFileData:function(){var y=a(this);var B=[];for(var A in y[0]["UploadFiles"]){var z=y[0]["UploadFiles"][A];B.push({fileID:A,name:z.data.name,mimeType:z.data.type,fileSize:z.data.size});
}return B;},DeleteFile:function(z){var y=a(this);if(y[0]["UploadFiles"][z]===undefined||y[0]["UploadFiles"][z]===null){return false;}delete y[0]["UploadFiles"][z];return true;},LoadFiles:function(z){var y=a(this);if(!y[0]["UploadFiles"]){y[0]["UploadFiles"]={};}a.each(z,function(B,A){y[0]["UploadFiles"][A.GUID]={"data":A,"finished":true};});},ClearAttachedFiles:function(){var y=a(this);delete y[0]["UploadFiles"];},CreateOverlay:function(){var y=a(this);if(a("#dropOverlay_"+y[0].id).length>0){y[0]["dropAreaOverlay"]=null;a("#dropOverlay_"+y[0].id).remove();}},DestroyOverlay:function(){var y=a(this);if(a("#dropOverlay_"+y[0].id).length>0){y[0]["dropAreaOverlay"]=null;a("#dropOverlay_"+y[0].id).remove();}},DestroyDropArea:function(){var z=a(this);z.unbind("drop");var y=a(document);y.unbind("dragenter",this[0].document_dragEnter);y.unbind("dragover",this[0].document_dragOver);y.unbind("dragleave",this[0].document_dragLeave);y.unbind("drop",this[0].document_drop);m.DestroyOverlay.apply(z[0]);
m.ClearAttachedFiles.apply(z[0]);}};if(l!=""){return m[l].call(this,o);}return this.each(function(){var z=a(this);n=a.extend({},e,n);this["dropAreaOptions"]=n;z[0].ondrop=function(A){g.dropArea_drop.apply(z[0],[A]);};var y=a(document);y.addListener("dragenter",this.document_dragEnter=function(A){g.document_dragEnter.apply(z[0],[A]);});y.addListener("dragover",this.document_dragOver=function(A){g.document_dragOver.apply(z[0],[A]);});y.addListener("dragleave",this.document_dragLeave=function(A){g.document_dragLeave.apply(z[0],[A]);});y.addListener("drop",this.document_drop=function(A){g.document_drop.apply(z[0],[A]);});d.apply(z[0]);if(n.enablePasteImage){z[0].onpaste=function(A){g.element_paste.apply(z[0],[A]);};if(z[0].addEventListener){z[0].addEventListener("input",function(A){g.element_change.apply(z[0],[A]);},false);}}});};var b=function(c){var d="";switch(c){case"doc":d="application/msword";break;case"docx":d="application/vnd.openxmlformats-officedocument.wordprocessingml.document";
break;case"pps":case"ppt":d="application/vnd.ms-powerpoint";break;case"pptx":d="application/vnd.openxmlformats-officedocument.presentationml.presentation";break;case"xls":d="application/vnd.ms-excel";break;case"xlsx":d="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";break;case"pdf":d="application/pdf";break;case"zip":d="application/zip";break;case"txt":d="text/plain";break;case"gif":d="image/gif";break;case"png":d="image/png";break;case"jpg":case"jpeg":case"jpe":d="image/jpeg";break;case"psd":d="image/vnd.adobe.photoshop";break;case"msg":d="application/vnd.ms-outlook";break;case"sql":d="text/x-sql";break;case"csv":d="application/vnd.ms-excel";break;case"mov":d="video/quicktime";break;case"mp4":d="video/mp4";break;case"mp3":d="audio/mpeg";break;case"wave":d="audio/wave";break;case"wav":d="audio/wav";break;case"eps":d="application/postscript";break;case"ai":d="application/postscript";break;case"key":d="application/x-iwork-keynote-sffkey";break;case"pages":d="application/x-iwork-pages-sffpages";
break;case"numbers":d="application/x-iwork-numbers-sffnumbers";break;case"rar":d="application/x-rar-compressed";break;case"7z":d="application/x-7z-compressed";break;case"rtf":d="application/rtf";break;}return d;};})(jQuery);(function(a){if(window["disableJsScrollPlugin"]){a.fn.jsScroll=function(){this.addClass("scrollable");};return;}(function(){var m=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"];var l="onwheel" in document||document["documentMode"]>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];var j,k;if(a["event"].fixHooks){for(var h=m.length;h;){a["event"].fixHooks[m[--h]]=a["event"].mouseHooks;}}a["event"].special.mousewheel={setup:function(){if(this.addEventListener){for(var n=l.length;n;){this.addEventListener(l[--n],g,false);}}else{this.onmousewheel=g;}},teardown:function(){if(this.removeEventListener){for(var n=l.length;n;){this.removeEventListener(l[--n],g,false);}}else{this.onmousewheel=null;}}};a.fn.extend({mousewheel:function(i){return i?this.addListener("mousewheel",i):this.trigger("mousewheel");
},unmousewheel:function(i){return this.unbind("mousewheel",i);}});function g(s){var u=s||window.event,o=[].slice.call(arguments,1),p=0,q=0,r=0,i=0,n=0,t;s=a["event"].fix(u);s.type="mousewheel";if(u.wheelDelta){p=(u.wheelDelta||0);}if(u.detail){p=(u.detail||0)*-1;}if(u.deltaY){r=(u.deltaY||0)*-1;p=r;}if(u.deltaX){q=(u.deltaX||0);p=q*-1;}if(u.wheelDeltaY!==undefined){r=(u.wheelDeltaY||0);}if(u.wheelDeltaX!==undefined){q=(u.wheelDeltaX||0)*-1;}i=Math.abs(p);if(!j||i<j){j=i;}n=Math.max(Math.abs(r),Math.abs(q));if(!k||n<k){k=n;}t=p>0?"floor":"ceil";p=Math[t](p/(j||1));q=Math[t](q/(k||1));r=Math[t](r/(k||1));o.unshift(s,p,q,r);return(a["event"].dispatch||a["event"].handle).apply(this,o);}})();a.fn.jsScroll=function(){var i=Array.prototype.splice.apply(arguments,[0]);var h=null;var g=null;if(i[0]&&typeof(i[0])=="string"){h=e[i[0]];g=i.splice(1);return this.each(function(j,k){h.apply(k[b.JSScrollAttrName],g);});}else{h=e.init;g=i;return this.each(function(j,k){h.apply(k,g);});}};var f=["iPad","iPhone","Android"];
var d=_.some(f,function(g){return navigator.userAgent.indexOf(g)>=0;});var b={ScrollHandlerClass:"scrollHandler",ScrollHandlerSelector:".scrollHandler",JSScrollAttrName:"jsscroll",HidingTimeout:"hiding"};var c={scrollWidth:5,focusedScrollBorder:10,minOpacity:0.01,maxOpacity:0.99,focusedScrollColor:"#333"};var e={init:function(g){if(d){a(this).css("overflow","scroll");return;}if(this[b.JSScrollAttrName]){this[b.JSScrollAttrName].refresh();return;}var h={scrollHeight:0,height:0,curTop:0,handlerHeight:10,options:null,element:null,railHeight:0,railStart:0,disposeTimeout:0,moving:false,startY:-1};h.options=a.extend(true,{},c,g);h.element=this;if(!a.fn.jsScroll.scrollCleaner){a.fn.jsScroll.items=[];a.fn.jsScroll.scrollCleaner=setInterval(function(){for(var k=0;k<a.fn.jsScroll.items.length;k++){if(a.fn.jsScroll.items[k].clearScrollEvents()){a.fn.jsScroll.items.splice(k,1);}}},5000);}a.fn.jsScroll.items.push(h);this[b.JSScrollAttrName]=h;for(var i in e){this[b.JSScrollAttrName][i]=e[i];}var j=this[b.JSScrollAttrName];
a(this).css("overflow","hidden");j.refresh();j.refreshHandlerOffset();a(this).addListener("mousewheel",function(n,k,l,m){return j.onWhell(n,k,l,m);});a(this).addListener("mouseover",function(k){return j.onMouseEnter(k);});a(this).addListener("mouseout",function(k){return j.onMouseOut(k);});a(this).addListener("touchstart",function(k){return j.onTouchStart(k);});a(this).addListener("touchmove",function(k){return j.onTouchMove(k);});a(this).addListener("touchend",function(k){return j.onTouchEnd(k);});if(a(this).attr("contenteditable")){a(this).addListener("DOMSubtreeModified",function(k){return j.refresh();});}j.onWindowScrollHandler=function(){j.onWindowScroll();};a(window).addListener("scroll",j.onWindowScrollHandler);a(window).addListener("resize",j.onWindowScrollHandler);},refresh:function(){if(!this.removeScroll){return;}this.removeScroll();this.addScroll();},addScroll:function(){var g=this.getCurrentSize();if(g.scrollHeight==0||g.scrollHeight<=g.height-2){return;}var j=this;var i={"z-index":"1001","position":"fixed","left":(g.width)+"px","width":j.options.scrollWidth+"px","backgroundColor":"#333","opacity":"0.01","transition":"opacity 0.5s ease","borderRadius":"2px"};
var h=a("<div>");h.addClass(b.ScrollHandlerClass);h.css(i);h.height(this.calcHandlerHeight(g.scrollHeight,g.height));if(a(this.element).attr("contenteditable")||a(this.element).is("ul")){h.insertAfter(this.element);}else{h.appendTo(this.element);}h.bind("mousedown",function(k){return j.onMouseDown(k);});h.bind("mouseover",function(k){this.style.borderLeft=j.options.focusedScrollBorder+"px solid "+j.options.focusedScrollColor;this.style.marginLeft="-"+j.options.focusedScrollBorder+"px";this.mouseHasLeft=false;});h.bind("mouseout",function(k){this.style.borderLeft="none";this.style.marginLeft="0";this.mouseHasLeft=true;});this.refreshHandlerPosition();},removeScroll:function(){var g=this.getHandler();g.unbind("mousedown");if(this.refreshPos){clearInterval(this.refreshPos);this.refreshPos=null;}g.remove();},getHandler:function(){if(a(this.element).attr("contenteditable")||a(this.element).is("ul")){return a(this.element).nextAll(b.ScrollHandlerSelector).first();}return a(this.element).children(b.ScrollHandlerSelector);
},refreshHandlerPosition:function(){this.refreshHandlerOffset();var g=this.getCurrentSize();var h=this.getHandler();h.css("top",this.calcHandlerTop(g.scrollHeight,g.height,g.scrollTop)+"px");h.css("display",(g.scrollHeight==0||g.scrollHeight<=g.height)?"none":"block");h.height(this.calcHandlerHeight(g.scrollHeight,g.height));},refreshHandlerOffset:function(){var g=a(this.element);var k=this;var l=this.getPageScroll();var i=this.getCurrentSize();var n=g.offset().top-l.top;var m=g.offset().left-l.left-k.options.scrollWidth;var h="translate("+m+"px"+","+n+"px"+")";var j=this.getHandler();j.css("transform",h);j.css("left",i.width+"px");},showScroll:function(){var g=this;setTimeout(function(){g.refreshHandlerPosition();if(g.element[b.HidingTimeout]){clearTimeout(g.element[b.HidingTimeout]);}g.element[b.HidingTimeout]=null;var h=g;g.getHandler().css("opacity",h.options.maxOpacity);},0);},hideScroll:function(){var g=this;clearTimeout(this.element[b.HidingTimeout]);this.element[b.HidingTimeout]=setTimeout(function(){var h=g;
g.getHandler().css("opacity",h.options.minOpacity);},300);},getPageScroll:function(){return{top:a("html")[0].scrollTop||a("body")[0].scrollTop,left:a("html")[0].scrollLeft||a("body")[0].scrollLeft};},getCurrentSize:function(){return{scrollHeight:this.element.scrollHeight,height:this.element.clientHeight,scrollTop:this.element.scrollTop,width:this.element.clientWidth};},onWhell:function(k,h,i,j){if(this.refreshPos){return;}var g=this.getCurrentSize();var o=navigator.userAgent.indexOf("Macintosh")>=0&&!window["__disableMacScrollTweak"]?1:70;var l=Math.floor((this.element.nextTop||g.scrollTop)-(o*j));l=Math.max(0,l);l=Math.min(l,g.scrollHeight-g.height);this.element.nextTop=l;var m=this;var n=function(p){return p>=0?1:-1;};if(!this.element.scrollRefresher){this.element.scrollRefresher=setInterval(function(){if(m.element.scrollTop==m.element.nextTop){clearInterval(m.element.scrollRefresher);m.element.scrollRefresher=null;m.element.nextTop=0;}else{var p=m.element.nextTop-m.element.scrollTop;
p=n(p)*Math.max(1,Math.abs(p)/3);m.element.scrollTop=m.element.scrollTop+p;m.refreshHandlerPosition();}},50);}if(Math.abs(i)==0){k.preventDefault();k.stopPropagation();}},stopScroll:function(){if(this.element.scrollRefresher){clearInterval(this.element.scrollRefresher);this.element.scrollRefresher=null;this.element.nextTop=0;}},onMouseEnter:function(){this.showScroll();},onMouseOut:function(){this.hideScroll();},onTouchStart:function(g){this.showScroll();var h=g.originalEvent;this.element.touchCoords={x:h.pageX,y:h.pageY,scrollTop:this.element.scrollTop};},onTouchMove:function(g){var h=g.originalEvent;var i={x:h.pageX,y:h.pageY};var j=this.element.touchCoords;this.element.scrollTop=j.scrollTop-(i.y-j.y);this.refreshHandlerPosition();g.preventDefault();g.stopPropagation();},onTouchEnd:function(g){this.hideScroll();this.element.touchCoords=null;g.preventDefault();g.stopPropagation();},onWindowScroll:function(){var g=this;g.refreshHandlerTimeout=setTimeout(function(){g.refreshHandlerPosition();
g.clearScrollEvents();g=null;},300);},clearScrollEvents:function(){if(!this.element||a(this.element).parents("body").length==0){a(window).unbind("scroll",this.onWindowScrollHandler);a(window).unbind("resize",this.onWindowScrollHandler);clearTimeout(this.refreshHandlerTimeout);delete this.refreshHandlerTimeout;return true;}return false;},onMouseMove:function(){},onMouseDown:function(g){this.startY=g.screenY;this.startTop=parseInt(this.getHandler().css("top"));this.currentY=g.screenY;var i=this;if(this.refreshPos){clearInterval(this.refreshPos);this.refreshPos=null;}this.refreshPos=setInterval(function(){var o=i.startY;var k=i.currentY;i.startY=k;var l=k-o;var j=i.getCurrentSize();var m=i.calcHandlerHeight(j.scrollHeight,j.height);var q=j.height-m;var p=i.startTop+l;p=Math.min(q,Math.max(0,p));i.startTop=p;var n=p*(j.scrollHeight-j.height)/q;i.element.scrollTop=Math.floor(n);i.refreshHandlerPosition();},33);var h=function(j){var k=i.getHandler()[0];if(k.mouseHasLeft){a(k).trigger("mouseover");
}i.currentY=j.screenY;};a("body").bind("mousemove",h);a("body").one("mouseup",function(j){clearInterval(i.refreshPos);i.refreshPos=null;a("body").unbind("mousemove",h);});a("body").one("mouseleave",function(j){clearInterval(i.refreshPos);i.refreshPos=null;a("body").unbind("mousemove",h);});g.preventDefault();g.stopPropagation();},calcHandlerHeight:function(h,g){return Math.max(5,Math.floor(g*g/h));},calcHandlerTop:function(i,h,j){var g=this.calcHandlerHeight(i,h);var l=h-g;var k=(j*l)/(i-h);return Math.floor(k);},dummy:function(){}};})(jQuery);(function(a){a.fn.scrollbar=function(b){this.addClass("scrollable");if(b){this.addClass("scroll-x");}};})(jQuery);(function(a){var b={groupHeader:"sa-group-header",groupHeaderWrapper:"sa-group-header-wrapper"};var j={groupHeader:".sa-group-header",groupHeaderWrapper:".sa-group-header-wrapper"};var c={options:"options",initialized:"initialized"};var d={};var h={};a.fn.scrollableAccordeon=function(o){var q=this;var p=a.fn.scrollableAccordeon;if(arguments.length>=1&&typeof(arguments[0])=="string"){var n=p.methods[arguments[0]];
var l=[];for(var m=1;m<arguments.length;m++){l.push(arguments[m]);}if(!n){throw"Metodo "+arguments[0]+" nao encontrado";}q.each(function(r){n.apply(this,l);});}else{o=a.extend({},d,o);var n=p.methods.init;q.each(function(r,s){a(s).data(c.options,o);n.apply(s,o);});}};a.fn.scrollableAccordeon.methods=h;a.fn.scrollableAccordeon.defaults=d;var e=function(l){return l.outerHeight(true);};var f=function(l){return l.outerWidth(true);};var k=function(){var m=this;var l=a(j.groupHeader,this).wrap('<div class="'+b.groupHeaderWrapper+'"/>');};var i=function(v){if(v){a(j.groupHeader,this).css({position:"static",top:"",width:""});}var C=this;var o=a(this);var B=this.scrollTop;var l=o.children();var A=o.offset().top;var G=a(window).scrollTop();l.each(function(K,J){var H=a(J);if(!H.data(c.initialized)||v){H.data(c.initialized,true);if(H.hasClass(b.groupHeaderWrapper)){var I=H.children().eq(0);H.css("height",e(I)+"px");I.css("cursor","pointer");I.click(function(L){var N=a(this).parent().prevAll(":visible");
var O=0;var M=0;N.each(function(){if(!a(this).hasClass(b.groupHeaderWrapper)){O+=a(this).outerHeight(true);}});a(this).parent().parent().scrollTop(O);});}}});var p=o.outerHeight(true);var n=null;var q=0;var E=0;var s=0;var z=-1;var u=l.length;var r=[];var m=o.children(j.groupHeaderWrapper);m.each(function(J,K){var I=a(K);var H=I.children(j.groupHeader);I.css("display",H.css("display"));});for(var w=0;w<l.length;w++){var x=l.eq(w);var y=x.css("display")=="none"?0:e(x);if(x.hasClass(b.groupHeaderWrapper)&&q<B+E){var t=x.children().first();var D=A+E-G;t.css({position:"fixed",top:D+"px",width:t.css("width")||f(x)+"px"});E+=y;z=w;}r.push(q);q+=y;}for(var w=l.length-1;w>z;w--){var x=l.eq(w);if(x.hasClass(b.groupHeaderWrapper)&&r[w]-B+s>p-e(x)){var t=x.children().first();var y=x.css("display")=="none"?0:e(x);var F=-r[w]+p-y+B-s;var D=A+p-s-y-G;t.css({position:"fixed",top:D+"px",width:t.css("width")||f(x)+"px"});s+=y;u=w;}}for(var w=z+1;w<u;w++){var x=l.eq(w);var t=x.children().first();t.css({position:"static",top:"",width:""});
}};var g=function(m){var l=a(this);var n=this;k.apply(this,[]);i.apply(this,[]);l.addListener("scroll",function(o){i.apply(n);});a(window).addListener("scroll",function(o){i.apply(n,[true]);});a(window).addListener("resize",function(o){i.apply(n,[true]);});};a.fn.scrollableAccordeon.methods.init=g;a.fn.scrollableAccordeon.methods.refresh=i;a.fn.scrollableAccordeon.methods.destroy=function(){var l=this;};})(jQuery);var SearchUser=(function(){function a(b){this.localUsersLoaded=false;this.searchBox=b.searchBox;this.mode=b.mode;this.renderUsers=b.renderUsers;this.clearAfterSelected=(b.clearAfterSelected===undefined)?true:b.clearAfterSelected;this.placeholder=b.placeholder||Resources.Commons.Search;this.selectedUsers=_.clone(b.initialUsers);this.originalSelectedUsers=_.clone(b.initialUsers);this.showUserIcon=(b.showUserIcon===undefined)?true:b.showUserIcon;this.excludeUsers=(b.excludeUsers===undefined)?[]:_.clone(b.excludeUsers);this.iconClass=(b.iconClass===undefined)?null:b.iconClass;this.allowAbsentUser=(b.allowAbsentUser===undefined)?true:b.allowAbsentUser;
this.allowInactiveUser=(b.allowInactiveUser===undefined)?false:b.allowInactiveUser;this.dueDate=(b.dueDate===undefined)?null:b.dueDate;this.SetupLocalUsers(b.usersToSearch==undefined?null:b.usersToSearch);}a.prototype.SetUsers=function(b){this.selectedUsers=_.clone(b);};a.prototype.GetSelectedUsers=function(){return this.selectedUsers;};a.prototype.SetupLocalUsers=function(f,c){var e=this;var d=c===true?function(){this.Reset();}.bind(this):$.noop;var b=function(g){this.localUsers=_.chain(g).clone().filter(function(h){return !h.SystemUser;}).value();this.localUsersLoaded=true;}.bind(this);if(!f){if(!this.allowInactiveUser){taskrow.ListUsers(function(g){b(g);d();});}else{$.get("User/ListUsers",{showInactive:true},function(g){b(g);d();});}}else{b(f);d();}};a.prototype.Unload=function(){var c=this;try{if($(c.txtBox).attr("typeahead_initialized")){$(c.txtBox).typeahead("destroy");}$(c.searchBox).html("");$(c.searchBox).removeClass("searchUserModeMultiple");$(c.searchBox).removeClass("searchUser");
}catch(b){}};a.prototype.Reset=function(){var b=this;if($(b.txtBox).attr("typeahead_initialized")){$(b.txtBox).typeahead("destroy");}$(b.txtBox).val("");b.SetupAutocomplete();b.SetUsers(b.originalSelectedUsers);b.RenderUsers();b.SetupPlaceholder();$(b.txtBox).focus();};a.prototype.SetSelectedUsers=function(b){this.selectedUsers=b;this.RenderUsers();};a.prototype.SetupAutocomplete=function(){var d=this;$(d.txtBox).parent().click(function(){$(d.txtBox).focus();});$(d.txtBox).parent(".input-prepend").addClass("memberSearch");if(this.mode==SearchUserMode.Multiple){$("<span>",{"class":"searchUserQueryWrap",html:$("<span>",{"css":{maxWidth:"100%",display:"block"},html:$("<span>",{"class":"searchUserQuery"})})}).insertBefore(d.txtBox);$(this.searchBox).addClass("searchUserModeMultiple");$(d.txtBox).keyup(function(){var g=$(".searchUserQuery",d.searchBox),f=$(this).prev(),i=$(this).val(),h=f.val();if(h==""){g.text(i);}else{g.text(h);}});}var e=function(g,h){if(d.allowAbsentUser===false&&d.dueDate!=null){var f=function(){g.preventDefault();
g.stopPropagation();$(d.txtBox).typeahead("val","");return false;};if(d.dueDate.diff($M(null,true),"days")<=0&&h.Absent){return f();}if(h.AbsenceStartDate!=null&&h.AbsenceEndDate!=null&&d.dueDate.diff($M(h.AbsenceStartDate),"days")>=0&&d.dueDate.diff($M(h.AbsenceEndDate),"days")<=0){return f();}}if(_.some(d.excludeUsers,function(j){return j.UserID==h.UserID;})){return false;}if(d.selectedUsers.length>0){var i=_.some(d.selectedUsers,function(j){return j.UserID==h.UserID;});if(i){if(d.clearAfterSelected){$(d.txtBox).typeahead("val","");}if(d.mode==SearchUserMode.Multiple||d.selectedUsers[0].UserID==h.UserID){g.preventDefault();g.stopPropagation();return false;}}}if(d.mode==SearchUserMode.Multiple){d.selectedUsers.push(h);}else{d.selectedUsers.splice(0,1,h);}if(d.clearAfterSelected){$(d.txtBox).typeahead("val","");}d.RenderUsers();d.SetupPlaceholder();if(d.selectUserCallback&&typeof(d.selectUserCallback)=="function"){d.selectUserCallback(h);}};if($(this.txtBox).attr("typeahead_initialized")){$(this.txtBox).typeahead("destroy");
}d.localUsers=_.filter(d.localUsers,function(f){return !_.contains(_.pluck(d.excludeUsers,"UserID"),f.UserID);}).map(function(f){f.ApprovalGroupd=f.ApprovalGroupd||" ";return f;});var c=new Bloodhound({datumTokenizer:function(f){return Bloodhound.tokenizers.whitespace([f.UserLogin,f.ApprovalGroup,Utils.RemoveAccents(f.UserLogin),Utils.RemoveAccents(f.ApprovalGroup)].join(" "));},queryTokenizer:Bloodhound.tokenizers.whitespace,sorter:function(f,g){var i=$(d.txtBox).val();if(i){i=Utils.RemoveAccents(i);var h=function(l){return[Utils.RemoveAccents(l.UserLogin).indexOf(i)==0?0:1,Utils.RemoveAccents(l.UserLogin).indexOf(i)>0?0:1,Utils.RemoveAccents(l.ApprovalGroup).indexOf(i)==0?0:1,Utils.RemoveAccents(l.ApprovalGroup).indexOf(i)>0?0:1,l.UserLogin].join("");};var j=h(f);var k=h(g);if(j<k){return -1;}else{if(j>k){return 1;}else{if(f.ApprovalGroup<g.ApprovalGroup){return -1;}else{if(f.ApprovalGroup>g.ApprovalGroup){return 1;}else{return 0;}}}}}return 0;},local:d.localUsers});c.initialize();var b=Resources.Absence.Absent+" "+Resources.Commons.Until.toLowerCase()+" {{_M AbsenceEndDate '#MomentShortDateFormat'}}";
$(this.txtBox).typeahead(null,{name:"search_user_"+$(d.searchBox).attr("id"),displayKey:"UserLogin",templates:{suggestion:Handlebars.compile('<div class="searchuser-template"><div class=""><span class="user-photo small" data-userid="{{UserID}}"><img src="{{SmallPhoto UserHashCode}}" alt="{{UserLogin}}"></span></div><div class="user-info"><span class="user-login">{{UserLogin}}</span>{{#if Absent}}<div class="absence-label">&nbsp;<span style="padding: 2px 4px;" class="label label-important" title="'+b+'"><i style="font-size: 10px; color: #fff; margin: 0;" class="icon-warning-sign"></i> '+Resources.Absence.Absent+"</span></div>{{/if}}"+'{{#if ExternalUser}}<div class="externalUser-badge">&nbsp;<span style="padding: 2px 4px;" class="label label-info" title="'+Resources.User.ExternalUser+'"><i style="font-size: 10px; color: #fff; margin: 0;" class="icon-warning-sign"></i> '+Resources.User.External+"</span></div>{{/if}}"+'{{#if Inactive}}<div class="externalUser-badge">&nbsp;<span style="padding: 2px 4px;" class="label label-default" title="'+Resources.User.Inactive+'"><i style="font-size: 10px; color: #fff; margin: 0;" class="icon-warning-sign"></i> '+Resources.User.Inactive+"</span></div>{{/if}}"+'<br /><span class="group-name">{{ApprovalGroup}}</span></div></div>')},source:c.ttAdapter()});
if(!$(this.txtBox).attr("typeahead_initialized")){$(this.txtBox).attr("typeahead_initialized","true");$(this.txtBox).addListener("typeahead:selected",e);$(this.txtBox).addListener("typeahead:autocompleted",e);}};a.prototype.SetupTextboxKeys=function(){var b=this;var c=$(this.txtBox);c.addListener("keyup",function(d){if(d.which==8){if(b.selectedUsers.length>0&&this.oldValue.length==0){setTimeout(function(){b.selectedUsers.pop();b.RenderUsers();b.SetupPlaceholder();if(b.deleteUserCallback&&typeof(b.deleteUserCallback)=="function"){b.deleteUserCallback(b.selectedUsers);}},0);d.stopPropagation();d.preventDefault();}}else{if(d.which==40){}}});c.addListener("keydown",function(d){this.oldValue=this.value;if(d.which==27){d.stopPropagation();d.preventDefault();$(this).typeahead("val","");$(this).focus();}else{if(d.which==40){}}});c.blur(function(){if(!this.returning){b.RenderUsers();b.SetupPlaceholder();}});};a.prototype.RenderUsers=function(){var e=this;if(!this.renderUsers){return;}var c=$(this.searchBox);
c.addClass("userlist");c.children(".user-photo").remove();var b=c.children().not(".user-photo");if(b.length>0){b=b.eq(0);}else{$("<span>").appendTo(this.searchBox);b=c.children().not(".user-photo").eq(0);}$(this.searchBox).children().not(".user-photo").eq(0);for(var d=0;d<this.selectedUsers.length;d++){var g=$("<span>").addClass("userMask");g.attr("username",this.selectedUsers[d].FullName);g.attr("userid",this.selectedUsers[d].UserID);g.attr("userlogin",this.selectedUsers[d].UserLogin);g.attr("class","user-photo small");g.attr("data-userid",this.selectedUsers[d].UserID);g.attr("title",this.selectedUsers[d].UserLogin);g.click(function(){e.DeleteUser($(this).data("userid"));});var f=$("<img>");f.attr("src",environmentData.userMask.SmallRelativeURL+this.selectedUsers[d].UserHashCode+".jpg");f.attr("alt",this.selectedUsers[d].UserLogin);f.appendTo(g);g.insertBefore(b);}this.SetupTextboxWidth();};a.prototype.SetupTextboxWidth=function(){var d=$(this.searchBox).width();var c=this.selectedUsers.length%Math.floor(d/32);
var b=d-(32*c)-25;$("input",$(this.txtBox).parent()).width(Math.max(b,55));};a.prototype.DeleteUser=function(c){var b=this;var d=$.grep(b.selectedUsers,function(e){return e.UserID!=c;});b.selectedUsers=d;b.RenderUsers();b.SetupPlaceholder();if(b.deleteUserCallback&&typeof(b.deleteUserCallback)=="function"){b.deleteUserCallback(b.selectedUsers);}};a.prototype.SetupPlaceholder=function(){if(this.mode==SearchUserMode.Multiple&&this.selectedUsers.length>0){$(this.txtBox).removeAttr("placeholder");}else{$(this.txtBox).attr("placeholder",this.placeholder);}};a.prototype.Init=function(){this.RenderUsers();$(this.searchBox).addClass("searchUser");var f=$("<input>").attr("type","text").attr("autocomplete","off");f.appendTo(this.searchBox);this.txtBox=f[0];if(this.mode==SearchUserMode.Unique){$(this.searchBox).addClass("Unique");var b='<i class="'+(this.iconClass||"icon-user")+'">';if(this.showUserIcon){var e=$('<span class="add-on">');$(b).appendTo(e);e.insertBefore($(this.txtBox));}if(this.selectedUsers.length>0){f.val(this.selectedUsers[0].UserLogin);
}}var c=this;var d=function(){if(c.localUsersLoaded){c.SetupAutocomplete();}else{setTimeout(d,100);}};d();this.SetupTextboxKeys();this.SetupPlaceholder();};return a;}());var ClientContactSearch=(function(){function a(b){this.localContactsLoaded=false;this.searchBox=b.searchBox;this.mode=b.mode;this.renderContacts=b.renderContacts;this.clearAfterSelected=(b.clearAfterSelected===undefined)?true:b.clearAfterSelected;this.placeholder=b.placeholder||Resources.Commons.Search;this.selectedContacts=_.clone(b.initialContacts);this.originalSelectedContacts=_.clone(b.initialContacts);this.excludeContacts=(b.excludeContacts===undefined)?[]:_.clone(b.excludeContacts);this.SetupLocalContacts(b.contactsToSearch==undefined?null:b.contactsToSearch);}a.prototype.SetContacts=function(b){this.selectedContacts=_.clone(b);};a.prototype.GetSelectedContacts=function(){return this.selectedContacts;};a.prototype.SetupLocalContacts=function(b){var c=this;if(!b){throw"erro";}else{c.localContacts=_.clone(b);c.localContactsLoaded=true;
}};a.prototype.Unload=function(){var b=this;setTimeout(function(){if($(b.txtBox).attr("typeahead_initialized")){$(b.txtBox).typeahead("destroy");}},10);};a.prototype.Reset=function(){if($(this.txtBox).attr("typeahead_initialized")){$(this.txtBox).typeahead("destroy");}$(this.txtBox).val("");this.SetupAutocomplete();this.SetContacts(this.originalSelectedContacts);this.RenderContacts();this.SetupPlaceholder();$(this.txtBox).focus();};a.prototype.SetupAutocomplete=function(){var c=this;$(c.txtBox).parent().click(function(){$(c.txtBox).focus();});$(c.txtBox).parent(".input-prepend").addClass("memberSearch");if(this.mode==ClientContactSearchMode.Multiple){$("<span>",{"class":"searchUserQueryWrap",html:$("<span>",{"css":{maxWidth:"100%",display:"block"},html:$("<span>",{"class":"searchUserQuery"})})}).insertBefore(c.txtBox);$(this.searchBox).addClass("searchUserModeMultiple");$(c.txtBox).keyup(function(){var f=$(".searchUserQuery",c.searchBox),e=$(this).prev(),h=$(this).val(),g=e.val();if(g==""){f.text(h);
}else{f.text(g);}});}var d=function(g,f){if(_.some(c.excludeContacts,function(e){return e.ClientContactID==f.ClientContactID;})){return false;}if(c.selectedContacts.length>0){var h=_.some(c.selectedContacts,function(e){return e.ClientContactID==f.ClientContactID;});if(h){if(c.clearAfterSelected){$(c.txtBox).typeahead("val","");}if(c.mode==ClientContactSearchMode.Multiple||c.selectedContacts[0].ClientContactID==f.ClientContactID){g.preventDefault();g.stopPropagation();return false;}}}if(c.mode==ClientContactSearchMode.Multiple){c.selectedContacts.push(f);}else{c.selectedContacts.splice(0,1,f);}if(c.clearAfterSelected){$(c.txtBox).typeahead("val","");}c.RenderContacts();c.SetupPlaceholder();if(c.selectContactCallback&&typeof(c.selectContactCallback)=="function"){c.selectContactCallback(f);}};if($(this.txtBox).attr("typeahead_initialized")){$(this.txtBox).typeahead("destroy");}c.localContacts=_.filter(c.localContacts,function(e){return !_.contains(_.pluck(c.excludeContacts,"ClientContactID"),e.ClientContactID);
}).map(function(e){e.ApprovalGroupd=e.ApprovalGroupd||" ";return e;});var b=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace([e.ContactName||"",e.ContactEmail||"",Utils.RemoveAccents(e.ContactName||""),Utils.RemoveAccents(e.OfficeArea||"")].join(" "));},queryTokenizer:Bloodhound.tokenizers.whitespace,local:c.localContacts});b.initialize();$(this.txtBox).typeahead(null,{name:"search_contact_"+$(c.searchBox).attr("id"),displayKey:"ContactName",templates:{suggestion:Handlebars.compile('<div class="searchuser-template" style="white-space: nowrap;"><div class=""><span class="contact-photo small" data-clientcontactid="{{ClientContactID}}"><img src="{{ContactPhoto ContactHashCode}}" alt="{{ContactName}}"></span></div><div class="user-info"><span class="contact-name">{{ContactName}}</span><br /><span class="contact-email">{{ContactEmail}}</span></div></div>')},source:b.ttAdapter()});if(!$(this.txtBox).attr("typeahead_initialized")){$(this.txtBox).attr("typeahead_initialized","true");
$(this.txtBox).addListener("typeahead:selected",d);$(this.txtBox).addListener("typeahead:autocompleted",d);}};a.prototype.SetupTextboxKeys=function(){var b=this;var c=$(this.txtBox);c.addListener("keyup",function(d){if(d.which==8){if(b.selectedContacts.length>0&&this.oldValue.length==0){setTimeout(function(){b.selectedContacts.pop();b.RenderContacts();b.SetupPlaceholder();if(b.deleteContactCallback&&typeof(b.deleteContactCallback)=="function"){b.deleteContactCallback(b.selectedContacts);}},0);d.stopPropagation();d.preventDefault();}}else{if(d.which==40){}}});c.addListener("keydown",function(d){this.oldValue=this.value;if(d.which==27){d.stopPropagation();d.preventDefault();$(this).typeahead("val","");$(this).focus();}else{if(d.which==40){}}});c.blur(function(){if(!this.returning){b.RenderContacts();b.SetupPlaceholder();}});};a.prototype.RenderContacts=function(){var f=this;if(!this.renderContacts){return;}var b=$(this.searchBox);b.addClass("userlist");b.children(".contact-photo").remove();
var c=b.children().not(".contact-photo");if(c.length>0){c=c.eq(0);}else{$("<span>").appendTo(this.searchBox);c=b.children().not(".contact-photo").eq(0);}for(var e=0;e<this.selectedContacts.length;e++){var d=$("<span>",{attr:{"contactname":this.selectedContacts[e].ContactName,"clientcontactid":this.selectedContacts[e].ClientContactID,"contactemail":this.selectedContacts[e].ContactEmail,"extranetenabled":this.selectedContacts[e].ExtranetEnabled,"termsaccepted":this.selectedContacts[e].TermsAccepted,"class":"contact-photo small","title":this.selectedContacts[e].ContactName}});d.click(function(){f.DeleteContact($(this).attr("clientcontactid"));});var g=$("<img>");g.attr("src",environmentData.userMask.ContactPhotoRelativeURL+this.selectedContacts[e].ContactHashCode+".jpg");g.attr("alt",this.selectedContacts[e].ContactName);g.appendTo(d);d.insertBefore(c);}this.SetupTextboxWidth();};a.prototype.SetupTextboxWidth=function(){var d=$(this.searchBox).width();var c=this.selectedContacts.length%Math.floor(d/32);
var b=d-(32*c)-25;$("input",$(this.txtBox).parent()).width(Math.max(b,55));};a.prototype.DeleteContact=function(b){var d=this;var c=$.grep(d.selectedContacts,function(e){return e.ClientContactID!=b;});d.selectedContacts=c;d.RenderContacts();d.SetupPlaceholder();if(d.deleteContactCallback&&typeof(d.deleteContactCallback)=="function"){d.deleteContactCallback(d.selectedContacts);}};a.prototype.SetupPlaceholder=function(){if(this.mode==ClientContactSearchMode.Multiple&&this.selectedContacts.length>0){$(this.txtBox).removeAttr("placeholder");}else{$(this.txtBox).attr("placeholder",this.placeholder);}};a.prototype.Init=function(){this.RenderContacts();$(this.searchBox).addClass("searchUser");var f=$("<input>").attr("type","text").attr("autocomplete","off");f.appendTo(this.searchBox);this.txtBox=f[0];if(this.mode==ClientContactSearchMode.Single){$(this.searchBox).addClass("Unique");var b='<i class="icon icon-user">';var e=$('<span class="add-on input-group-addon">');$(b).appendTo(e);e.insertBefore($(this.txtBox));
if(this.selectedContacts.length>0){f.val(this.selectedContacts[0].UserLogin);}}var c=this;var d=function(){if(c.localContactsLoaded){c.SetupAutocomplete();}else{setTimeout(d,100);}};d();this.SetupTextboxKeys();this.SetupPlaceholder();};return a;}());var TagItem=(function(){function a(e,f,d,c,b,g){this.name=e;this.id=d||e;this.savedOnServer=(!f)?false:f;this.displayName=c||e;this.colorID=b;this.tagGroup=g||"";}return a;}());var TagSelector=(function(){function a(b,c){this.input=b;this.SetupSettings(c);}a.prototype.SetupSettings=function(b){this.currentSettings={useTabKey:true,placeholder:Resources.Commons.Search,width:-1,disabledMode:false,maxSelection:10,contextTags:new Array(),initialTags:new Array(),allowFreeEntries:true,orderField:"name",displayField:"name",valueField:"id",renderer:null,selectionRenderer:null,selectionCls:null,selectionItemClass:null};_.extend(this.currentSettings,b);};a.prototype.Reset=function(){var b=this;this.currentTags=_.clone(b.currentSettings.initialTags);this.instance.clear();
this.instance.addToSelection(this.currentTags);};a.prototype.Init=function(){this.SetupSelectTag();};a.prototype.Enable=function(){this.instance.empty();this.instance.enable();};a.prototype.Disable=function(){this.instance.disable();};a.prototype.SetData=function(b){this.instance.setData(b);};a.prototype.SetSelectedValues=function(b){this.instance.setSelection(b);};a.prototype.GetSelectedValues=function(){return this.instance.getValue();};a.prototype.Clear=function(){this.instance.clear();};a.prototype.SetupSelectTag=function(){var b=this;var c=$.map(b.currentSettings.initialTags,function(d){return d.id;});this.instance=$(b.input).magicSuggest({emptyText:b.currentSettings.placeholder,noSuggestionText:Resources.Commons.NoSuggestion,data:b.currentSettings.contextTags,disabled:b.currentSettings.disabledMode,sortOrder:b.currentSettings.orderField,width:b.currentSettings.width==-1?$(b.input).parent().width():b.currentSettings.width,value:c,useTabKey:b.currentSettings.useTabKey,maxSelection:b.currentSettings.maxSelection,toggleOnClick:true,allowFreeEntries:b.currentSettings.allowFreeEntries,displayField:b.currentSettings.displayField,valueField:b.currentSettings.valueField,groupBy:b.currentSettings.groupBy,renderer:b.currentSettings.renderer,selectionRenderer:b.currentSettings.selectionRenderer,selectionCls:b.currentSettings.selectionCls,selectionItemClass:b.currentSettings.selectionItemClass});
$(this.instance).on("selectionchange",function(d,f,g){$(f.input).focus();if(b.selectionchangeCallback&&typeof b.selectionchangeCallback=="function"){b.selectionchangeCallback(g);}});};return a;}());var EnumTimepickerMode;(function(a){a[a["Hours"]=0]="Hours";a[a["Days"]=1]="Days";})(EnumTimepickerMode||(EnumTimepickerMode={}));(function(a){a.fn.timesheetpicker=function(c){var f=null;var d="";var g=[];if(arguments.length>=1&&typeof(arguments[0])=="object"){f=arguments[0];}else{if(arguments.length>=1&&typeof(arguments[0])=="string"){d=arguments[0];g=arguments[1];}}var b={target:"",container:"",btPrev:null,btNext:null,btRemaining:null,currentUsedTime:null,displayCurrentTime:null,displayText:null,timeList:[0,15,30,45,60,90,120,150,180,210,240,270,300,330,360,390,420,450,480,510,540,570,600,630,660,690,720,780,840,900,960,1020,1080,1140,1200,1260,1320,1380],dayList:_.range(23).map(function(h){return(h+1)*480;}),timeListIdx:null,timeIdx:null,initCallback:a.noop,setTimecallback:a.noop,displayClass:"btn",containerClass:"",editable:true,displayTextCursor:"",placeHolderText:"0",openStart:true,buttonSize:"small",keepEditMode:false,mode:EnumTimepickerMode.Hours,zeroToPlaceholder:true,showTimes:0};
var e={init:function(h){this.attr=a.extend(true,{},b,h);this.attr.target=a(this);a(this).wrap('<div class="timesheet_item_container clearfix '+this.attr.buttonSize+'" />');this.attr.container=a(this).parent();a(this.attr.container).addClass(this.attr.containerClass);if(!this.attr.editable){this.attr.displayTextCursor="default";}e.loadTimelistIndex.call(this);this.attr.initCallback();},loadRemainingButton:function(){var h=this;var i=a(h).val();var j=(i=="")?0:parseInt(i);var k=a(h).attr("data-original-minutesspent");var l=(k=="")?0:parseInt(k);var m=parseInt(a(h).attr("data-remaining"));if(m>0&&j<(m+l)){var n=(h.attr.buttonSize=="mini")?"width: 123px;":"width: 159px;";h.attr.btRemaining=a("<button type='button' class='timesheet_item_btRemaining btn btn-"+h.attr.buttonSize+"' style='float: left; margin-top: 3px; "+n+"'>"+Resources.Timesheet.CompleteDay+"</span>").appendTo(this.attr.container);a(h.attr.btRemaining).click(function(o){o.stopPropagation();h.attr.currentUsedTime=m+l;a(h).val(h.attr.currentUsedTime);
var q=h.attr.mode==EnumTimepickerMode.Days?h.attr.timeList:h.attr.dayList;for(var p=0;p<q.length;p++){if(h.attr.currentUsedTime<=q[p]){h.attr.timeIdx=p;h.attr.timeListIdx=Math.floor(parseInt(p)/6)*6;if(h.attr.timeListIdx>(q.length-6)){h.attr.timeListIdx=(q.length-6);}break;}}e.refreshTimeIdx.call(h);e.minuteToHour.call(h);if(!h.attr.keepEditMode){a(h.attr.container).parent().parent().removeClass("edit");a(h.attr.container).find(".timesheet_item_timer_nav").remove();a(h.attr.container).find(".timesheet_item_timer_select").remove();a(h.attr.container).find(".timesheet_item_btRemaining").remove();h.attr.displayCurrentTime=a("<span class='"+h.attr.displayClass+" "+h.attr.displayTextCursor+"'>"+h.attr.displayText+"</span>").appendTo(h.attr.container);if(h.attr.editable){a(h.attr.displayCurrentTime).click(function(r){r.stopPropagation();e.showEditMode.call(h);});}}h.attr.container.find(".timesheet_item_timer_select button").removeClass("active");h.attr.setTimecallback(h.attr.currentUsedTime,true);
});}},loadTimelistIndex:function(){var h=this;this.attr.currentUsedTime=a(this).val();var k=this.attr.mode==EnumTimepickerMode.Hours?this.attr.timeList:this.attr.dayList;for(var j=0;j<k.length;j++){if(this.attr.currentUsedTime<=k[j]){this.attr.timeIdx=j;this.attr.timeListIdx=Math.floor(parseInt(j)/6)*6;if(this.attr.timeListIdx>(k.length-6)){this.attr.timeListIdx=(k.length-6);}break;}}e.createDisplayCurrentTime.call(this);},refreshTimeIdx:function(){var j=this.attr.mode==EnumTimepickerMode.Hours?this.attr.timeList:this.attr.dayList;for(var h=0;h<j.length;h++){if(this.attr.currentUsedTime<=j[h]){this.attr.timeIdx=h;break;}}},minuteToHour:function(){var h=this;var i=h.attr.currentUsedTime;h.attr.displayText=h.attr.mode==EnumTimepickerMode.Hours?Utils.MinuteToHour(i):Utils.MinuteToDays(i);if(h.attr.displayText=="0"&&(h.attr.showTimes==0||h.attr.zeroToPlaceholder)){h.attr.displayText=h.attr.placeHolderText;}},changeMode:function(j){var h=this;if(h.attr.mode!=j){h.attr.mode=j;e.reset.call(h);
var i=h.attr.mode==EnumTimepickerMode.Hours?h.attr.timeList:h.attr.dayList;e.clearTimeContainer.call(h);h.attr.timeIdx=0;h.attr.timeListIdx=0;if(h.attr.timeListIdx>(i.length-6)){h.attr.timeListIdx=(i.length-6);}e.createButtonTimeList.call(h);e.loadRemainingButton.call(h);}},reset:function(){var h=this;a(h.attr.displayCurrentTime).remove();a(h.attr.container).find(".timesheet_item_timer_nav").remove();a(h.attr.container).find(".timesheet_item_timer_select").remove();a(h.attr.container).find(".timesheet_item_btRemaining").remove();h.attr.currentUsedTime="0";e.refreshTimeIdx.call(h);a(h).val("0");h.attr.container.find(".timesheet_item_timer_select button").not(this).removeClass("active");e.minuteToHour.call(h);e.loadTimelistIndex.call(h);},createDisplayCurrentTime:function(){var h=this;e.minuteToHour.call(this);if(this.attr.openStart===true&&this.attr.editable){e.showEditMode.call(h);}else{if(this.attr.openStart===undefined&&this.attr.editable){if(this.attr.displayText>0||(this.attr.displayText!=""&&this.attr.displayText!="0")){this.attr.displayCurrentTime=a("<span class='"+this.attr.displayClass+" "+this.attr.displayTextCursor+"'>"+this.attr.displayText+"</span>").appendTo(this.attr.container);
a(this.attr.displayCurrentTime).click(function(i){i.stopPropagation();e.showEditMode.call(h);});}else{e.showEditMode.call(h);}}else{if(this.attr.openStart===false&&this.attr.editable){this.attr.displayCurrentTime=a("<span class='"+this.attr.displayClass+" "+this.attr.displayTextCursor+"'>"+this.attr.displayText+"</span>").appendTo(this.attr.container);a(this.attr.displayCurrentTime).click(function(i){i.stopPropagation();e.showEditMode.call(h);});}else{this.attr.displayCurrentTime=a("<span class='"+this.attr.displayClass+" "+this.attr.displayTextCursor+"'>"+this.attr.displayText+"</span>").appendTo(this.attr.container);}}}},closeEditMode:function(){var h=this;a(this.attr.container).parent().parent().removeClass("edit");a(this.attr.container).find(".timesheet_item_timer_nav").remove();a(this.attr.container).find(".timesheet_item_timer_select").remove();a(this.attr.container).find(".timesheet_item_btRemaining").remove();e.minuteToHour.call(this);this.attr.displayCurrentTime=a("<span class='"+this.attr.displayClass+" "+this.attr.displayTextCursor+"'>"+this.attr.displayText+"</span>").appendTo(this.attr.container);
if(h.attr.editable){a(h.attr.displayCurrentTime).click(function(i){i.stopPropagation();e.showEditMode.call(h);});}this.attr.setTimecallback(this.attr.currentUsedTime);return;},showEditMode:function(){var h=this;this.attr.showTimes++;a(this.attr.displayCurrentTime).remove();var i='<div class="timesheet_item_timer_select"></div><div class="timesheet_item_timer_nav"><button type="button" class="btn btn-'+this.attr.buttonSize+' up" data-value="prev"><i class="icon-chevron-up"></i></button><button type="button" class="btn btn-'+this.attr.buttonSize+' down" data-value="next"><i class="icon-chevron-down"></i></button></div>';a(i).appendTo(this.attr.container);e.createButtonTimeList.call(h);a(this.attr.container).parent().parent().addClass("edit");a(this.attr.container).find(".timesheet_item_timer_nav button").click(function(){var j=h.attr.mode==EnumTimepickerMode.Hours?h.attr.timeList:h.attr.dayList;if(a(this).attr("data-value")=="next"){e.clearTimeContainer.call(h);h.attr.timeListIdx+=6;if(h.attr.timeListIdx>(j.length-6)){h.attr.timeListIdx=(j.length-6);
}e.createButtonTimeList.call(h);}else{if(a(this).attr("data-value")=="prev"){e.clearTimeContainer.call(h);h.attr.timeListIdx-=6;if(h.attr.timeListIdx<6){h.attr.timeListIdx=0;}e.createButtonTimeList.call(h);}}});e.loadRemainingButton.call(this);},setButtonTimeClick:function(){var h=this;a(this.attr.container).find(".timesheet_item_timer_select button").click(function(){h.attr.currentUsedTime=a(this).attr("data-value");e.refreshTimeIdx.call(h);a(h).val(a(this).attr("data-value"));e.minuteToHour.call(h);if(!h.attr.keepEditMode){a(h.attr.container).parent().parent().removeClass("edit");a(h.attr.container).find(".timesheet_item_timer_nav").remove();a(h.attr.container).find(".timesheet_item_timer_select").remove();a(h.attr.container).find(".timesheet_item_btRemaining").remove();h.attr.displayCurrentTime=a("<span class='"+h.attr.displayClass+" "+h.attr.displayTextCursor+"'>"+h.attr.displayText+"</span>").appendTo(h.attr.container);if(h.attr.editable){a(h.attr.displayCurrentTime).click(function(i){i.stopPropagation();
e.showEditMode.call(h);});}}a(this).addClass("active");h.attr.container.find(".timesheet_item_timer_select button").not(this).removeClass("active");h.attr.setTimecallback(h.attr.currentUsedTime);});},setMinutes:function(i){var h=this;h.attr.currentUsedTime=i;e.refreshTimeIdx.call(h);a(h).val(i);e.minuteToHour.call(h);h.attr.container.find(".timesheet_item_timer_select button").removeClass("active");h.attr.container.find(".timesheet_item_timer_select button[data-value="+i+"]").removeClass("active");h.attr.setTimecallback(h.attr.currentUsedTime);},clearTimeContainer:function(){var h=this;a(this.attr.container).find(".timesheet_item_timer_select button").remove();},createButtonTimeList:function(){var h=this;function n(i){var q=h.attr.mode==EnumTimepickerMode.Hours?Utils.MinuteToHour(i):Utils.MinuteToDays(i);if(q==""){q=0;}return q;}var l=this.attr.mode==EnumTimepickerMode.Hours?this.attr.timeList:this.attr.dayList;var o="";var j="";if(this.attr.mode==EnumTimepickerMode.Hours){o="days";j="hours";
}else{o="hours";j="days";}var m=this.attr.mode==EnumTimepickerMode.Hours?"hours":"days";for(var k=0;k<6;k++){var p=(this.attr.timeIdx>0&&this.attr.timeIdx==(k+this.attr.timeListIdx))?"active":"";a(this.attr.container).find(".timesheet_item_timer_select").addClass(j).removeClass(o).append('<button type="button" class="btn btn-'+this.attr.buttonSize+" "+p+'" data-value="'+l[(k+this.attr.timeListIdx)]+'">'+n(l[(k+this.attr.timeListIdx)])+"</button>");}e.setButtonTimeClick.call(h);},remove:function(){var h=this;a(h.attr.displayCurrentTime).remove();a(h.attr.container).find(".timesheet_item_timer_nav").remove();a(h.attr.container).find(".timesheet_item_timer_select").remove();a(h.attr.container).find(".timesheet_item_btRemaining").remove();}};if(d!=""){if(e[d]){return this.each(function(){e[d].call(this,g);});}else{a.error("Method '"+d+"' does not exist on jQuery.timesheetpicker");return;}}return this.each(function(){e.init.call(this,f);});};})(jQuery);var WallPost=(function(){function a(d,c,b){this.jobNumber=null;
this.clientNickName=null;this.reloadCallback=$.noop;this.wallContainer=d;this.originalData=c;this.allowNewPosts=(b!=null)?b:true;}a.prototype.Unload=function(){Utils.CleanNode(this.wallContainer);};a.prototype.Init=function(){this.postLimit=5;this.viewModel=new ViewModel({});this.RefreshViewModel(this.originalData);this.lastUpdateTime=$M(this.originalData.LastUpdateTime);this.SetupWallPost();};a.prototype.SetupWallPost=function(){var b=this;var c="Partials/WallPost",d=taskrow.templatePath+c;taskrow.DisplayLoading();taskrow.LoadTemplate(d,function(e){$(b.wallContainer).html(e({}));ko.applyBindings(b.viewModel,b.wallContainer);b.inputElement=$("#wallPostText")[0];$(b.inputElement).addListener("blur",function(){b.WrapLinks();});b.SetupEntityUrl();if(b.allowNewPosts){b.SetupAttachmentControl();}taskrow.HideLoading();});};a.prototype.HidePostArea=function(){if(!$(".post-area",this.wallContainer).hasClass("closed")){$(".post-area",this.wallContainer).addClass("closed");$("#wallPostText").text(Resources.Wall.WallPostArea);
$("#wallpostsAttachmentContainer").fadeOut(100);$("#attachmentsAddedContainer").fadeOut(100);}};a.prototype.ShowPostArea=function(){if($(".post-area",this.wallContainer).hasClass("closed")){$(".post-area",this.wallContainer).removeClass("closed");$("#wallPostText").text("");$("#wallpostsAttachmentContainer").fadeIn(100);$("#attachmentsAddedContainer").fadeIn(100);}};a.prototype.SetupEntityUrl=function(){var b=this;$.each($(b.wallContainer).find("a[href=#][data-url]"),function(c,d){$(d).attr("href",URLs.BuildUrl($(d).attr("data-url")));});};a.prototype.SetupAttachmentControl=function(){var b=this;if(!b.attachmentControl){require(["Scripts/Plugins/AttachmentControl"],function(){b.attachmentControl=new AttachmentControl({attachmentContainer:$("#wallPostText")[0],contextName:"wallposts",buttonSave:$("#btnSavePost")[0],btnAddAttachment:$("#btnAddAttachmentButton"),attachmentFilesListContainer:$("#attachmentsAddedContainer"),templateProvider:taskrow,moduleContainer:taskrow});b.attachmentControl.Init();
});}};a.prototype.DeleteAttachment=function(b){var c=this;var d=b.WallPostID;Utils.DeleteAttachment(b,function(e){var f=_.indexOf(_.pluck(c.viewModel.WallPost(),"WallPostID"),d);c.viewModel.WallPost()[f].Attachments=e;c.viewModel.WallPost()[f].AttachmentList(e);});};a.prototype.RefreshViewModel=function(b){_.each(b.WallPost,function(d){d.AttachmentList=ko.observableArray(d.Attachments);});var c=$.extend(true,{AllowNewPost:this.allowNewPosts,JobNumber:this.jobNumber,ClientNickName:this.clientNickName,Text:""},b);this.viewModel.refreshData(c);};a.prototype.SavePost=function(){if(!this.allowNewPosts){$(".post-area",$(this.wallContainer)).remove();return false;}if($("#wallPostText")[0].innerHTML.length==0||$("#wallPostText")[0].innerHTML=="<br>"){UI.Alert(Resources.Wall.PostTextRequired);return false;}this.viewModel.Text($("#wallPostText")[0].innerHTML);$("#btnSavePost").button("loading");taskrow.DisplayLoading();$("#frmSaveWallPost").submit();};a.prototype.WrapLinks=function(){var c=this.SelectNodes(this.inputElement,"https?://[^ \t\r\n]+");
for(var b=0;b<c.length;b++){var e=$(c[b].node).parents(":not(#wallPostText)");if(e.is("a")){continue;}var f=document.createRange();f.setStart(c[b].node,c[b].start);f.setEnd(c[b].node,c[b].end);var d=$("<a>",{"target":"_blank","href":c[b].content})[0];f.surroundContents(d);}};a.prototype.SelectNodes=function(k,h){var e=[];var g=[];var l=new RegExp(h,"gi");e.push(k);for(var c=0;c<e.length;c++){var n=e[c];if(n.nodeType==3){var f=null;while(f=l.exec(n.textContent)){var m=f[0];g.push({node:n,start:f.index,end:f.index+m.length,content:m});}}else{var b=n.childNodes;if(!b){continue;}for(var d=0;d<b.length;d++){e.push(b[d]);}}}return g;};a.prototype.SaveWallPost_End=function(c){taskrow.HideLoading();$("#btnSavePost").button("reset");if(c.status!=200){UI.Alert(Resources.Wall.ErrorOnSave);return;}var b=JSON.parse(c.responseText);if(!b.Success){UI.Alert(b.Message);}else{$("#wallPostText")[0].innerHTML="";var e=b.Entity;e.AttachmentList=ko.observableArray(e.Attachments);var d=$.inArray(e.WallPostID,_.pluck(taskrow.currentModule.wallPost.viewModel.WallPost(),"WallPostID"));
if(d>-1){taskrow.currentModule.wallPost.viewModel.WallPost.splice(d,1,e);}else{taskrow.currentModule.wallPost.viewModel.WallPost.splice(0,0,e);}taskrow.currentModule.wallPost.attachmentControl.Reset();taskrow.currentModule.wallPost.reloadCallback(e);taskrow.currentModule.wallPost.HidePostArea();}};a.prototype.SaveComment=function(e){var c=this;var d=$("#postComment"+e)[0];var b=$("#btnSaveComment"+e)[0];if(!d||$(d)[0].innerHTML.length==0||$(d)[0].innerHTML=="<br>"){UI.Alert(Resources.Wall.PostTextRequired);return false;}$(b).button("loading");$.ajax({url:"Wall/SaveWallComment",type:"POST",data:{wallPostID:e,text:$(d).text()},success:function(f){$(b).button("reset");if(!f.Success){UI.Alert(f.Message);}else{$(d).empty();var h=f.Entity;h.AttachmentList=ko.observableArray(h.Attachments);var g=$.inArray(h.WallPostID,_.pluck(c.viewModel.WallPost(),"WallPostID"));if(g>-1){c.viewModel.WallPost.splice(g,1,h);}else{c.viewModel.WallPost.splice(0,0,h);}c.reloadCallback(h);}},error:function(h,g,f){$(b).button("reset");
if(console){console.error(g);}}});};a.prototype.LoadUserWall=function(e,c){var d=this;var b=(c)?0:this.postLimit;if(c){b=0;$("#btnRefreshPosts i").addClass("icon-spin");}else{$("#btnMorePosts").button("loading");}$.ajax({url:"Wall/GetUserWall",traditional:true,data:{limit:b,wallPostListID:e,lastUpdateTime:this.lastUpdateTime.format("YYYY-MM-DD HH:mm:ss")},success:function(f){d.lastUpdateTime=$M(f.LastUpdateTime);d.LoadMorePostsCallback(f.WallPost,f.UpdatedWallPost,f.NewPostList);if(c){$("#btnRefreshPosts i").removeClass("icon-spin");}else{$("#btnMorePosts").button("reset");}},error:function(h,g,f){if(c){$("#btnRefreshPosts i").removeClass("icon-spin");}else{$("#btnMorePosts").button("reset");}if(console){console.error(g);}}});};a.prototype.RefreshPosts=function(b){this.LoadMorePosts(b,true);};a.prototype.LoadMorePosts=function(e,c){var d=this;var f=_.pluck(this.viewModel.WallPost(),"WallPostID");if(this.userWall){d.LoadUserWall(f,c);}else{var b=this.postLimit;if(c){b=0;$("#btnRefreshPosts i").addClass("icon-spin");
}else{$(".more-posts").attr("title",Resources.Commons.Loading).addClass("loading");}$.ajax({url:"Wall/LoadWallPosts",traditional:true,data:{jobNumber:this.jobNumber,clientNickName:this.clientNickName,wallID:e.WallID(),limit:b,wallPostListID:f,lastUpdateTime:this.lastUpdateTime.format("YYYY-MM-DD HH:mm:ss")},success:function(g){d.lastUpdateTime=$M(g.LastUpdateTime);d.LoadMorePostsCallback(g.WallPost,g.UpdatedWallPost,g.NewPostList);if(c){$("#btnRefreshPosts i").removeClass("icon-spin");}else{$(".more-posts").attr("title",Resources.Wall.LoadMorePosts).removeClass("loading");}},error:function(i,h,g){if(c){$("#btnRefreshPosts i").removeClass("icon-spin");}else{$(".more-posts").attr("title",Resources.Wall.LoadMorePosts).removeClass("loading");}if(console){console.error(h);}}});}};a.prototype.LoadMorePostsCallback=function(h,g,d){var f=this;for(var b=0;b<g.length;b++){var e=g[b];var c=$.inArray(e.WallPostID,_.pluck(this.viewModel.WallPost(),"WallPostID"));if(e.Inactive){this.viewModel.WallPost.splice(c,1);
}else{e.AttachmentList=ko.observableArray(e.Attachments);if(c>-1){this.viewModel.WallPost.splice(c,1,e);}}}for(var b=0;b<d.length;b++){d[b].AttachmentList=ko.observableArray(d[b].Attachments);}for(var b=0;b<h.length;b++){h[b].AttachmentList=ko.observableArray(h[b].Attachments);}f.viewModel.WallPost(_.union(d,f.viewModel.WallPost(),h));};a.prototype.DeleteWallComment=function(c,b){if(b.CreationUserID!=environmentData.currentUserID){UI.Alert(Resources.DenialOfAccess.DeleteWallComment);return false;}UI.ConfirmYesNo(Resources.Wall.ConfirmDeleteWallComment,function(){taskrow.DisplayLoading();$.ajax({url:"Wall/DeleteWallComment",type:"POST",data:{wallCommentID:b.WallCommentID},success:function(d){taskrow.HideLoading();if(!d.Success){UI.Alert(d.Message);}else{var e=$.inArray(b.WallCommentID,_.pluck(c.WallComment,"WallCommentID"));if(e>-1){c.WallComment.splice(e,1);$("#wallComment"+b.WallCommentID).remove();}}},error:function(f,e,d){taskrow.HideLoading();if(console){console.error(e);}}});});};a.prototype.DeleteWallPost=function(b){if(b.CreationUserID!=environmentData.currentUserID){UI.Alert(Resources.DenialOfAccess.DeleteWallPost);
return false;}var c=this;UI.ConfirmYesNo(Resources.Wall.ConfirmDeleteWallPost,function(){$.ajax({url:"Wall/DeleteWallPost",type:"POST",data:{wallPostID:b.WallPostID},success:function(d){taskrow.HideLoading();if(!d.Success){UI.Alert(d.Message);}else{c.viewModel.WallPost.remove(b);}},error:function(f,e,d){taskrow.HideLoading();if(console){console.error(e);}}});});};return a;}());var JSRouteManager=(function(){function a(){this.patternRegex=/((([a-zA-Z0-9]+)|(\:[a-zA-Z0-9]+))([?]|(\(\/.*\/[gimy]*\)))?)\/?/gi;this.onRoute=new Array();this.routes=new Array();this.globalTests=new Array();}a.prototype.RegisterEvent=function(b,c,d){if(b.addEventListener){b.addEventListener(c,d,false);}else{if(b["attachEvent"]){b["attachEvent"]("on"+c,d);}}};a.prototype.ParseRoutePattern=function(d){var c=null;var g=new Array();while((c=this.patternRegex.exec(d))!=null){var e=c[5];var b=c[2];var f=new JSRouteSegment();if(b[0]==":"){f.Name=b.substr(1);}else{f.Constant=b;}if(e&&["?","*"].indexOf(e)>=0){f.Rule=c[5];
}else{if(e){f.Regex=(/\(\/(.*)\/\)/gi).exec(e)[1];}}g.push(f);}return new JSRouteDefinition(d,g);};a.prototype.ExecuteOnRoute=function(c){for(var b=0;b<this.onRoute.length;b++){this.onRoute[b](c);}};a.prototype.RouteHash=function(d){var k=d.substr(1);for(var e=0;e<this.routes.length;e++){var h=this.routes[e];if(h.PreTest&&!h.PreTest(h,d,null)){continue;}var g=h.TestRoute(k);if(g){if(!h.ByPassGlobalTests){var c=false;for(var f=0;f<this.globalTests.length;f++){if(!this.globalTests[f](h,location.hash,[])){c=true;break;}}if(c){continue;}}var b=g.splice(1);if(h.PostTest&&!h.PostTest(h,d,b)){break;}this.ExecuteOnRoute(h);h.Listener.apply(window,b);return;}}if(this.fallBack){this.fallBack();}};a.prototype.SetupOldBrowsers=function(){var b=this;this._hashChangeInterval=setInterval(function(){var c=location.hash;if(c!=b.previousHash){b.RouteHash(location.hash);}b.previousHash=c;},100);};a.prototype.OnLocationHashChange=function(c){var d=this;var b=location.hash;d.RouteHash(location.hash);d.previousHash=b;
};a.prototype.Register=function(c,b){var d=this.ParseRoutePattern(c);d.Listener=b;this.routes.push(d);return d;};a.prototype.RegisterFallback=function(b){this.fallBack=b;};a.prototype.AddOnRoute=function(b){this.onRoute.push(b);};a.prototype.AddGlobalTest=function(b){this.globalTests.push(b);};a.prototype.Init=function(){var b=this;if(!("onhashchange" in window)){this.SetupOldBrowsers();}else{this.RegisterEvent(window,"hashchange",this.OnLocationHashChange.bind(this));}setTimeout(function(){b.RouteHash(location.hash);},1000);};return a;}());var JSRouteDefinition=(function(){function a(c,d,b){this.ByPassGlobalTests=false;this.Pattern=c;this.Segments=d;this.Listener=b;}a.prototype.TestBefore=function(b){this.PreTest=b;return this;};a.prototype.TestAfter=function(b){this.PostTest=b;return this;};a.prototype.DisableGlobalTests=function(){this.ByPassGlobalTests=true;return this;};a.prototype.GetRouteDescriptor=function(){if(this.descriptor){return this.descriptor;}var b="";for(var c=0;c<this.Segments.length;
c++){b+="/";var d=this.Segments[c];if(d.Constant){b+=d.Constant;}else{b+=":"+d.Name;}}this.descriptor=b||"/";return b;};a.prototype.GetRouteRegex=function(){if(this.regexp){return this.regexp;}var c="^/?";for(var b=0;b<this.Segments.length;b++){var d=this.Segments[b];var e="";if(b<this.Segments.length-1){e="/";}if(d.Constant){c+=d.Constant+e;}else{if(d.Rule){c+="([^/]+)"+d.Rule+e+d.Rule;}else{if(d.Regex){c+="("+d.Regex+")"+e;}else{c+="([^/]+)"+e;}}}}c+="/?$";this.regexp=new RegExp(c,"gi");return this.regexp;};a.prototype.TestRoute=function(f){var d=this.GetRouteRegex();d.exec("");var c=d.exec(f);if(!c&&!_.endsWith(f,"/")){f=f+"/";d.exec("");c=d.exec(f);if(!c){return null;}}else{if(!c&&_.endsWith(f,"/")){f=f.substr(0,f.length-1);d.exec("");c=d.exec(f);if(!c){return null;}}}var e=[];for(var b=0;b<c.length;b++){e.push(c[b]);}return e;};return a;}());var JSRouteSegment=(function(){function a(){}return a;}());var PivotTable=(function(){function a(b){this.originalData=null;this.pivotArgs=null;
this.dataIsFiltered=false;this.containerTable=b;}a.prototype.SetupGenericReport=function(b){this.currentSettings={args:null,defaultAggregator:{name:"sum"},derivedAttributes:[],filter:null,hideTotalsCol:false,hideTotalsRow:false,monthly:false,yearly:true,renameColumnTitles:[],renameRowValues:[],renameColumnValues:[],renameRowTitles:[],rowNames:[],hideRows:[],indicators:[],fixHeader:false,searchFilterColumns:[],detailClickEnabled:false};_.extend(this.currentSettings,b);};a.prototype.Pivot=function(e){var b="";(function(i,k){if(k.currentSettings.defaultAggregator.fn){b=k.currentSettings.defaultAggregator.fn;}if(!b&&k.currentSettings.defaultAggregator.name){b=i.pivotUtilities.aggregators[k.currentSettings.defaultAggregator.name];}})(jQuery,this);var d=[];if(this.currentSettings.colNames){d=this.currentSettings.colNames;}else{if(this.currentSettings.monthly){d.push(Resources.Commons.Day);}else{if(this.currentSettings.yearly){d.push(Resources.Commons.Month);}}}this.colsLength=d.length;if(this.currentSettings.indicators.length>0){this.currentSettings.rowNames=this.currentSettings.rowNames.concat(["Order","Label"]);
this.currentSettings.hideRows.push("Order");}var j=[];if(this.currentSettings.rowNames){for(var g=0;g<this.currentSettings.rowNames.length;g++){if(typeof(this.currentSettings.rowNames[g])!="string"){j.push(this.currentSettings.rowNames[g].name);}else{j.push(this.currentSettings.rowNames[g]);}}}$(this.containerTable).html("");var h={rows:j,cols:d,colsNotExport:this.currentSettings.colsNotExport||[],aggregator:b,filter:this.currentSettings.filter?this.currentSettings.filter:undefined,derivedAttributes:_.object(_.map(this.currentSettings.derivedAttributes,function(i){return[i.name,i.fn];}))};var f=(this.currentSettings.indicators.length>0)?this.SetupPivotDataIndicators(e,this.currentSettings.indicators):e;this.ClearFilter();this.pivotArgs=h;this.originalData=f;var c=$(this.containerTable).pivot(Array.prototype.slice.apply(f,[0]),h);this.RenameAxisLabels(c);this.FormatTable(c);};a.prototype.ApplyFilter=function(){var g=this;var b=$(".searchText",$(g.containerTable).parent().parent());var f=Utils.RemoveAccents(b.val());
if(!f||f.length==0){return false;}var e=_.chain(this.originalData).filter(function(m){var l=false;for(var k=0;k<g.currentSettings.searchFilterColumns.length;k++){var h=g.currentSettings.searchFilterColumns[k];var j=Utils.RemoveAccents(m[h].toLowerCase());l=j.indexOf(f)>-1;if(l){break;}}return l;}).value();var c=$(this.containerTable).pivot(Array.prototype.slice.apply(e,[0]),this.pivotArgs);this.RenameAxisLabels(c);this.FormatTable(c);var d=taskrow.currentModule;d.SetupExportToExcel();b.disable();$("span.search",$(g.containerTable).parent().parent()).hide();$("span.remove-search",$(g.containerTable).parent().parent()).show();this.dataIsFiltered=true;};a.prototype.ClearFilter=function(){var b=$(".searchText",$(this.containerTable).parent().parent());b.val("");b.enable();$("span.search",$(this.containerTable).parent().parent()).show();$("span.remove-search",$(this.containerTable).parent().parent()).hide();this.dataIsFiltered=false;};a.prototype.RemoveFilter=function(){this.ClearFilter();var b=$(this.containerTable).pivot(Array.prototype.slice.apply(this.originalData,[0]),this.pivotArgs);
this.RenameAxisLabels(b);this.FormatTable(b);var c=taskrow.currentModule;c.SetupExportToExcel();};a.prototype.GetMonthArray=function(){return[Resources.Month.Jan,Resources.Month.Feb,Resources.Month.Mar,Resources.Month.Apr,Resources.Month.MayShort,Resources.Month.Jun,Resources.Month.Jul,Resources.Month.Aug,Resources.Month.Sep,Resources.Month.Oct,Resources.Month.Nov,Resources.Month.Dec];};a.prototype.FormatTable=function(b){var q=b.children("table");var d=q.children("tbody").children("tr").eq(0).children(".pvtAxisLabel");var s=$(".pvtVal",q);s.each(function(j,v){var i=v.innerHTML.replace(/[^0-9a-zA-Z-.,]/gi,"");if(i=="0"||i=="000"){$(v).addClass("zero");}if((Utils.ParseFloat(i)||0)<0){$(v).addClass("negative-value");}});if(this.currentSettings.detailClickEnabled){$(q).addClass("detailClickEnabled");}if(this.currentSettings.yearly&&!this.currentSettings.monthly){var d=q.children("tbody").children("tr").eq(0).children(".pvtColLabel");var k={};for(var f=0;f<12;f++){k[_.lpad((f+1),2,"0")]=this.GetMonthArray()[f];
}for(var f=0;f<d.length;f++){var n=/[01][0-9]/gi;if(n.test(d[f].innerHTML)){d[f].innerHTML=k[d[f].innerHTML];}}}var m=q.children("tbody").children("tr");for(var f=1;f<m.length;f++){var l=$(m[f]);var e=false;var c=l.children();for(var h=0;h<c.length;h++){var n=/[a-zA-Z1-9]/gi;var g=c[h];if(!n.test(g.innerHTML)){continue;}e=true;break;}if(!e){l.hide();}}var o=this;this.HideRowValues(q);if(this.currentSettings.hideTotalsRow){var u=q.children("tbody").children("tr").children("td.rowTotal, td.pvtGrandTotal, th.pvtTotalLabel:first").hide();}if(this.currentSettings.hideTotalsCol){var t=q.children("tbody").children("tr").children("td.colTotal").parent().hide();}if(this.currentSettings.indicators.length>0&&!this.currentSettings.hideTotalsRow){var r=q.children("tbody").children("tr");var p=o.currentSettings.colNames.length+1;_.each(o.currentSettings.indicators,function(w,v){if(!w.hideTotalRow){return false;}var x=r.eq(p+v)[0];if(x){var j=$(x).children("td.rowTotal");if(j&&j.length>0){j[0].innerHTML="";
}}});}if(this.currentSettings.fixHeader===true){UI.FixNestedTable(q[0],this.colsLength+1);}if(!this.currentSettings.searchFilterColumns||this.currentSettings.searchFilterColumns.length==0){$(".search-filter",$(o.containerTable).parent().parent()).hide();}};a.prototype.HideRowValues=function(e){var d=this;if(this.currentSettings.hideRows.length>0){if(this.currentSettings.hideRows.length==this.currentSettings.rowNames.length){throw"Invalid argument hideRows: número de hideRows não pode ser igual ao número de rowNames";}_.each(this.currentSettings.hideRows,function(j,i){var h=_.lastIndexOf(d.currentSettings.rowNames,j);if(h>-1){if(h==d.currentSettings.hideRows.length-1){_.each(e.children("tbody").children("tr:gt(0)"),function(k){$(k).children("td, th").eq(h).not(".pvtTotalLabel").remove();});}else{_.each(e.children("tbody").children("tr:gt(0)"),function(l){var k=$(l).children("td, th").eq(h);if(k.hasClass("pvtAxisLabel")){k.remove();}else{k.not(".pvtTotalLabel").html("");}});_.each(e.children("tbody").children("tr:gt(1):not(:last)"),function(l){var m=$(l).children("th").eq(h);
var k=parseInt($(l).children("th").eq(h).attr("colspan"));k--;$(l).children("th").eq(h).attr("colspan",Math.max(k,0).toString());});}}});var c=e.children("tbody").children("tr:first").children("th:first");var b=c.attr("colspan")-this.currentSettings.hideRows.length;c.attr("colspan",Math.max(b,0).toString());var g=e.children("tbody").children("tr:last").children("th:first");var f=g.attr("colspan")-this.currentSettings.hideRows.length;g.attr("colspan",Math.max(f,0).toString());}};a.prototype.RenameAxisLabels=function(b){var d=$(".pvtAxisLabel",b);for(var c=0;c<d.length;c++){var e=_.where(this.currentSettings.renameRowTitles,{"from":d[c].innerHTML})[0];if(!e){e=_.where(this.currentSettings.renameColumnTitles,{"from":d[c].innerHTML})[0];}if(e){d[c].innerHTML=e.to;}}};a.prototype.SetupPivotDataIndicators=function(b,d){var c=_.chain(b).map(function(e,f){var g=[];_.each(d,function(j,h){g.push({Month:e.Month,Order:h,Label:j.label,Value:e[j.propertieName]});});return g;}).flatten().value();return c;
};a.prototype.OnPivotClick=function(b){$(this.containerTable).bind("taskrow:pivotclick",(function(d,c){$("td.pvtVal",this.containerTable).removeClass("selected");$(c.td).addClass("selected");b.apply(this,[c]);}).bind(this));};return a;}());var TableControl=(function(){function a(b){this.containerTable=b;this.viewModel=new TableControlViewModel();}a.prototype.SetupGenericReport=function(b){this.currentSettings={args:null,monthly:false,yearly:true,columns:[],fixHeader:false};_.extend(this.currentSettings,b);};a.prototype.LoadTable=function(c){this.viewModel.Data.RefreshData(c);this.viewModel.Columns(this.currentSettings.columns);var d=this.currentSettings.filterText;this.viewModel.EnableFilterText(d);this.viewModel.RowClassExpression=this.currentSettings.rowClassExpression;if(d){var b=_.chain(this.currentSettings.columns).map(function(e){return e.name;}).pluck("from").value();this.viewModel.Data.FilterTextColumns(b);}else{this.viewModel.Data.FilterTextColumns.removeAll();}this.FormatTable();
if(this.currentSettings.sortOptions){this.viewModel.Data.SetOrder(this.currentSettings.sortOptions);}};a.prototype.FormatTable=function(){if(this.currentSettings.fixHeader===true){UI.FixNestedTable($("table",this.containerTable)[0]);}};return a;}());var TableControlViewModel=(function(){function a(){var b=this;this.Data=new DataSource([]);this.Columns=ko.observableArray([]);this.EnableFilterText=ko.observable(false);this.GroupRowsByPrefix=ko.observable(true);this.VisibleColumns=ko.computed(function(){return b.Columns().filter(function(d,e){return b.ShowColumn(undefined,d,0,e);});},this);}a.prototype.ShowIcon=function(c,b){var d=false;if(b.showIcon!=null){d=b.showIcon(c);}return d;};a.prototype.ShowColumn=function(h,e,i,c){var b=this;var k=true;if(i>0&&e.vMergeable){var j=this.Data.FilteredData();var d=this.Columns();var g=_.range(0,c+1).map(function(l){return b.FormatValue(j[i-1],d[l]);});var f=_.range(0,c+1).map(function(l){return b.FormatValue(h,d[l]);});if(!g.find(function(m,l){return f[l]!=m;
})){return false;}}if(typeof(e.showColumn)=="boolean"){return e.showColumn;}if(e.showColumn&&h){k=e.showColumn(h);}return k;};a.prototype.GetRowSpan=function(m,e,n,c){var b=this;var l=1;var o=this.Data.FilteredData();var d=this.Columns();if(!e.vMergeable){return l;}var f=_.range(0,c+1).map(function(j){return b.FormatValue(m,d[j]);});for(var g=n+1;g<o.length;g++){for(var h=0;h<=c;h++){var k=this.FormatValue(o[g],d[h]);if(k!=f[h]){return l;}if(h==c){l++;}}}return l;};a.prototype.GetRowClass=function(b){if(!this.RowClassExpression){return"";}return this.RowClassExpression(b)||"";};a.prototype.FormatUrl=function(c,b){if(!b.urlColumn||!c[b.urlColumn]){return"";}return URLs.BuildUrl(c[b.urlColumn]);};a.prototype.FormatValue=function(c,b){if(b.expression!=null){return b.expression(c);}if(!c[b.name.from]){return"";}if(b.type==EnumTableColumnType.String){return c[b.name.from];}if(b.type==EnumTableColumnType.Interger){return c[b.name.from].toFixed(0);}if(b.type==EnumTableColumnType.Float){return Utils.FormatCurrency(c[b.name.from],b.fractionalDigits);
}if(b.type==EnumTableColumnType.Boolean){return c[b.name.from]==true?Resources.Commons.Yes:Resources.Commons.No;}if(b.type==EnumTableColumnType.DateTime){return c[b.name.from]!=null?$M(c[b.name.from]).toShortString():"";}if(b.type==EnumTableColumnType.Currency){return Utils.FormatCurrency(c[b.name.from],b.fractionalDigits);}return c[b.name.from]||"";};return a;}());var EnumTableColumnType;(function(a){a[a["String"]=1]="String";a[a["Interger"]=2]="Interger";a[a["Float"]=3]="Float";a[a["Boolean"]=4]="Boolean";a[a["DateTime"]=5]="DateTime";a[a["Currency"]=6]="Currency";a[a["Link"]=7]="Link";})(EnumTableColumnType||(EnumTableColumnType={}));